<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KBOB Fachdatenkatalog</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    
    <style>
        /* ============================================
           CSS VARIABLES - Swiss Federal Design System
           ============================================ */
        :root {
            /* =====================
               COLOR SYSTEM
               ===================== */

            /* Primary Brand Colors */
            --color-primary: #DC0018;
            --color-primary-light: #F7001D;
            --color-primary-dark: #B00014;

            /* Interactive Colors */
            --color-interactive: #006699;
            --color-interactive-hover: #005580;
            --color-focus: #66AFE9;
            --color-focus-input: #6366f1;

            /* Neutral Colors */
            --color-black: #000000;
            --color-text-primary: #1a2a3a;
            --color-text-secondary: #4a5568;
            --color-text-muted: #718096;
            --color-border: #e2e8f0;
            --color-border-light: #e5e7eb;
            --color-border-input: #9ca3af;
            --color-bg-alt: #f7fafc;
            --color-bg-light: #f0f4f7;
            --color-white: #FFFFFF;

            /* Surface Colors */
            --color-surface: #f7fafc;
            --color-surface-alt: #edf2f7;
            --color-surface-blue: #ebf4ff;
            --color-highlight: #FFFAB2;

            /* Status Colors */
            --color-success: #3C763D;
            --color-success-bg: #DFF0D8;
            --color-warning: #8A6D3B;
            --color-warning-bg: #FCF8E3;
            --color-error: #A94442;
            --color-error-bg: #F2DEDE;
            --color-info: #31708F;
            --color-info-bg: #D9EDF7;

            /* Dark UI Colors (footer, contact sections) */
            --color-surface-dark: #3d4f5f;
            --color-surface-darker: #2d3a44;

            /* =====================
               TYPOGRAPHY
               ===================== */

            --font-family-primary: 'Noto Sans', 'Helvetica Neue', 'Arial', sans-serif;
            --font-family-mono: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;

            /* Type Scale (Major Third - 1.25 ratio) */
            --text-display: 2.25rem;    /* 36px */
            --text-h1: 1.75rem;         /* 28px */
            --text-h2: 1.5rem;          /* 24px */
            --text-h3: 1.25rem;         /* 20px */
            --text-h4: 1.125rem;        /* 18px */
            --text-h5: 1rem;            /* 16px */
            --text-body: 1rem;          /* 16px */
            --text-body-sm: 0.875rem;   /* 14px */
            --text-caption: 0.75rem;    /* 12px */
            --text-label: 0.875rem;     /* 14px */

            /* Line Heights */
            --line-height-tight: 1.2;
            --line-height-snug: 1.3;
            --line-height-normal: 1.5;

            /* Font Weights */
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;

            /* =====================
               SPACING (4px base unit)
               ===================== */

            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
            --space-3xl: 64px;
            --space-4xl: 80px;

            /* =====================
               LAYOUT
               ===================== */

            --container-max-width: 1564px;
            --container-padding: var(--space-xl);  /* 32px - consistent edge padding for all sections */
            --grid-gutter: 24px;

            /* Breakpoints */
            --breakpoint-sm: 576px;
            --breakpoint-md: 768px;
            --breakpoint-lg: 992px;
            --breakpoint-xl: 1200px;
            --breakpoint-logo: 1024px;  /* Logo full/minimal switch */

            /* Component Dimensions */
            --header-height: 146px;
            --nav-height: 64px;
            --footer-height: 64px;
            --toolbar-height: 46px;

            /* =====================
               BORDERS & SHADOWS
               ===================== */

            --border-radius-sm: 2px;
            --border-radius: 4px;
            --border-radius-lg: 8px;
            --border-radius-full: 9999px;

            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);

            /* =====================
               TRANSITIONS
               ===================== */

            --transition-fast: 150ms ease;
            --transition-normal: 250ms ease;
            --transition-slow: 350ms ease;

            /* =====================
               Z-INDEX SCALE
               ===================== */

            --z-dropdown: 100;
            --z-topbar: 150;
            --z-sticky: 200;
            --z-modal-backdrop: 300;
            --z-modal: 400;
            --z-tooltip: 500;

        }

        /* ============================================
           RESET & BASE STYLES
           ============================================ */
        * { box-sizing: border-box; }

        html {
            scroll-behavior: smooth;
            height: 100%;
        }

        body {
            font-family: var(--font-family-primary);
            margin: 0;
            padding: 0;
            color: var(--color-text-primary);
            background-color: var(--color-white);
            font-size: var(--text-body);
            line-height: var(--line-height-normal);
            -webkit-font-smoothing: antialiased;
            display: flex;
            flex-direction: column;
            min-height: 100%;
        }

        h1, h2, h3, h4, h5, h6 {
            margin: 0;
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            line-height: var(--line-height-snug);
            letter-spacing: -0.02em;
        }

        h1 { font-size: var(--text-h1); }
        h2 { font-size: var(--text-h2); }
        h3 { font-size: var(--text-h3); }
        h4 { font-size: var(--text-h4); }

        p {
            margin: 0 0 1em 0;
            color: var(--color-text-secondary);
        }

        a {
            color: var(--color-primary);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        a:hover {
            color: var(--color-primary);
            text-decoration: underline;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: var(--space-sm); height: var(--space-sm); }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--color-border); border-radius: var(--border-radius); }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-text-muted); }

        /* Utility Classes */
        .container {
            width: 100%;
            max-width: var(--container-max-width);
            margin-inline: auto;
            padding-inline: var(--container-padding);
        }
        .hidden { display: none !important; }

        /* Screen Reader Only - Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focusable Screen Reader Only - For Skip Links */
        .sr-only--focusable:focus,
        .sr-only--focusable:active {
            position: fixed;
            top: var(--space-sm);
            left: var(--space-sm);
            width: auto;
            height: auto;
            padding: var(--space-sm) var(--space-md);
            margin: 0;
            overflow: visible;
            clip: auto;
            white-space: normal;
            background-color: var(--color-white);
            color: var(--color-primary);
            font-weight: var(--font-weight-semibold);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: calc(var(--z-tooltip) + 1);
            text-decoration: none;
        }

        /* Focus States - Accessibility */
        :focus-visible {
            outline: 2px solid var(--color-focus);
            outline-offset: 2px;
        }

        :focus:not(:focus-visible) {
            outline: none;
        }

        /* ============================================
           ICON SYSTEM (Swiss Federal Design - Lucide)
           ============================================ */

        /* Lucide Icon Base Styles */
        [data-lucide] {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
            display: inline-block;
            vertical-align: middle;
            flex-shrink: 0;
        }

        /* Icon Sizes */
        [data-lucide].icon--sm { width: 16px; height: 16px; }
        [data-lucide].icon--lg { width: 24px; height: 24px; }
        [data-lucide].icon--xl { width: 80px; height: 80px; stroke-width: 1; }
        [data-lucide].icon--3xl { width: 48px; height: 48px; stroke-width: 1.5; }
        [data-lucide].icon--4xl { width: 64px; height: 64px; stroke-width: 1; }

        /* Interactive Icon (inherits link color) */
        .icon--interactive {
            color: var(--color-primary);
        }

        .icon--interactive:hover {
            color: var(--color-primary);
        }

        /* Icon Link Pattern (icon + text) */
        .icon-link {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            text-decoration: none;
            color: var(--color-primary);
        }

        .icon-link:hover {
            color: var(--color-primary);
            text-decoration: underline;
        }

        .icon-link [data-lucide] {
            flex-shrink: 0;
        }

        /* ============================================
           HEADER (Swiss Federal Design)
           ============================================ */
        header {
            position: relative;
            z-index: 1; /* Niedriger als top-bar, damit lang-dropdown darüber erscheint */
            flex-shrink: 0;
        }

        .header__top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-block: var(--space-lg);
            padding-inline: var(--container-padding);
            max-width: var(--container-max-width);
            margin-inline: auto;
            position: relative; /* For mobile lang-switch positioning */
        }

        .header__branding {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            text-decoration: none;
            color: inherit;
        }

        .header__branding:hover {
            text-decoration: none;
        }

        /* Swiss Coat of Arms */
        .header__logo {
            width: 34px;
            height: 34px;
            flex-shrink: 0;
        }

        .header__logo img {
            width: 100%;
            height: 100%;
        }

        /* Multilingual Confederation Text */
        .header__confederation {
            font-size: 11px;
            line-height: 1.4;
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-normal);
            white-space: nowrap;
            margin-bottom: 30px;
        }

        /* Vertical Separator Line */
        .header__separator {
            width: 1px;
            height: 60px;
            background-color: var(--color-border);
            margin: 0 var(--space-lg);
            flex-shrink: 0;
        }

        /* Main Title (KBOB / Fachdatenkatalog) */
        .header__title {
            font-size: var(--text-body);
            font-weight: var(--font-weight-normal);
            color: #333;
            line-height: var(--line-height-tight);
        }

        .header__title span {
            display: block;
        }

        .header__title span:first-child {
            font-weight: var(--font-weight-bold);
        }

        /* Top Bar (CD Bund) */
        .top-bar {
            background: #3e5060;
            height: 46px;
            position: relative;
            z-index: var(--z-topbar);
        }

        .top-bar__container {
            max-width: var(--container-max-width);
            margin-inline: auto;
            padding-inline: var(--container-padding);
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }

        /* Language Dropdown */
        .lang-dropdown {
            position: relative;
        }

        .lang-dropdown__toggle {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            background: transparent;
            border: none;
            color: #fff;
            font-size: var(--text-body-sm);
            font-family: inherit;
            cursor: pointer;
            padding: var(--space-sm);
            padding-left: var(--space-md);
            padding-right: 0;  /* Chevron aligns with right edge */
        }

        .lang-dropdown__toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .lang-dropdown__toggle:focus {
            outline: none;
        }

        .lang-dropdown__toggle svg {
            width: 16px;
            height: 16px;
        }

        .lang-dropdown__menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: #3e5060;
            min-width: 100%; /* Gleiche Breite wie Toggle */
            display: none;
            z-index: var(--z-dropdown);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 2px solid transparent;
        }

        .lang-dropdown.open .lang-dropdown__menu {
            display: block;
            border-color: #6f42c1; /* Lila Border wenn offen */
        }

        .lang-dropdown__menu:hover {
            border-color: #6f42c1; /* Lila Hover Border */
        }

        .lang-dropdown__item {
            display: block;
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            color: #fff;
            text-decoration: none;
            font-size: var(--text-body-sm);
            border: none;
            background: transparent;
            text-align: left;
            cursor: pointer;
            font-family: inherit;
        }

        .lang-dropdown__item:hover {
            background: #0066b3;
        }

        .lang-dropdown__item:focus {
            outline: none;
            background: #0066b3;
        }

        .lang-dropdown__item.active {
            /* Keine spezielle Hintergrundfarbe für aktive Sprache */
        }

        /* Header Controls (Kontakt, Search) */
        .header__controls {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            align-self: flex-start;
            gap: var(--space-md);
        }

        .header__links {
            display: flex;
            gap: var(--space-md);
        }

        .header__link {
            font-size: var(--text-body-sm);
            color: var(--color-text-secondary);
            text-decoration: none;
        }

        .header__link:hover {
            color: var(--color-primary);
            text-decoration: underline;
        }

        .header__search {
            position: relative;
            display: flex;
            align-items: center;
        }

        .header__search-toggle {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            background: none;
            border: none;
            cursor: pointer;
            font-size: var(--text-body-sm);
            color: var(--color-text-secondary);
            padding: var(--space-xs);
            font-family: inherit;
            transition: color 0.2s ease, opacity 0.2s ease;
        }

        .header__search-toggle:hover {
            color: var(--color-primary);
        }

        .header__search-toggle svg {
            width: 16px;
            height: 16px;
        }

        /* Hide toggle when search is open - fade out smoothly */
        .header__search.open .header__search-toggle {
            opacity: 0;
            pointer-events: none;
        }

        /* Progressive disclosure: form expands from 0 width */
        .header__search-form {
            position: absolute;
            right: 0;
            display: flex;
            align-items: center;
            overflow: hidden;
            width: 0;
            opacity: 0;
            pointer-events: none;
            transition: width 0.3s ease-out, opacity 0.2s ease-out;
        }

        /* Expanded state - width-based animation */
        .header__search.open .header__search-form {
            width: 260px;
            opacity: 1;
            pointer-events: auto;
        }

        .header__search-input {
            width: 100%;
            padding: var(--space-sm) 3.5rem var(--space-sm) var(--space-md);
            border: 2px solid var(--color-focus-input);
            border-radius: var(--border-radius);
            font-size: var(--text-body-sm);
            font-family: inherit;
            outline: none;
            background: #fafaff;
            transition: background-color 0.2s ease, box-shadow 0.2s ease;
        }

        .header__search-input::placeholder {
            color: var(--color-text-muted);
        }

        .header__search-input:focus {
            background: var(--color-white);
            box-shadow: var(--shadow-md);
        }

        /* Hide native browser clear button on search inputs */
        .header__search-input::-webkit-search-cancel-button,
        .search-hero__input::-webkit-search-cancel-button {
            -webkit-appearance: none;
            appearance: none;
        }

        .header__search-submit {
            position: absolute;
            right: 8px;
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            color: var(--color-focus-input);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s ease;
        }

        .header__search-submit:hover {
            color: var(--color-primary);
        }

        .header__search-submit svg {
            width: 18px;
            height: 18px;
        }

        .header__search-clear {
            position: absolute;
            right: 32px;
            background: none;
            border: none;
            padding: 4px;
            cursor: pointer;
            color: var(--color-text-muted);
            display: none;
            align-items: center;
            justify-content: center;
            transition: color 0.2s ease;
        }

        .header__search-clear:hover {
            color: var(--color-text-primary);
        }

        .header__search-clear.visible {
            display: flex;
        }

        .header__search-clear svg {
            width: 16px;
            height: 16px;
        }

        /* ============================================
           NAVIGATION (Swiss Federal Style)
           ============================================ */
        .main-nav {
            background: var(--color-white);
            border-top: 1px solid var(--color-border-light);
            border-bottom: 1px solid var(--color-border-light);
            height: var(--nav-height);
        }

        .main-nav .container {
            max-width: var(--container-max-width);
            margin-inline: auto;
            padding-inline: var(--container-padding);
            height: 100%;
        }

        .main-nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-xl);
            height: 100%;
            align-items: stretch;
        }

        .main-nav li {
            display: flex;
            align-items: center;
        }

        .nav-link {
            text-decoration: none;
            color: var(--color-text-secondary);
            display: flex;
            align-items: center;
            height: 100%;
            font-size: var(--text-body);
            transition: color var(--transition-fast);
        }

        .nav-link:hover:not(.disabled):not(.active) {
            color: var(--color-primary);
            text-decoration: none;
        }

        .nav-link.active {
            color: var(--color-text-primary);
            position: relative;
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            border-bottom: 3px solid var(--color-primary);
        }

        .nav-link.active:hover {
            color: var(--color-primary);
            text-decoration: none;
        }

        .nav-link.disabled {
            color: var(--color-text-muted);
            cursor: default;
            opacity: 0.6;
        }

        /* ============================================
           BREADCRUMB BAR (Swiss Federal Style)
           ============================================ */
        .breadcrumb-bar {
            background: var(--color-white);
        }

        .breadcrumb-bar .container {
            max-width: var(--container-max-width);
            margin-inline: auto;
            padding-inline: var(--container-padding);
        }

        /* Simplified structure: removed .breadcrumb-row and .toolbar-row wrappers */
        .breadcrumb-bar__inner {
            display: flex;
            flex-direction: column;
            align-items: stretch;
            padding: var(--space-md) 0;
            gap: var(--space-sm);
        }

        .breadcrumb-nav {
            display: flex;
            align-items: center;
            height: 50px;
            gap: var(--space-sm);
            font-size: var(--text-body-sm);
            color: var(--color-text-secondary);
            flex-wrap: wrap;
        }

        .breadcrumb-nav a {
            color: var(--color-text-secondary);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        .breadcrumb-nav a:hover {
            color: var(--color-primary);
            text-decoration: none;
        }

        .breadcrumb-item {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .breadcrumb-nav .breadcrumb-separator {
            color: var(--color-text-muted);
            font-size: var(--text-caption);
            display: inline-flex;
            align-items: center;
        }

        .breadcrumb-nav .breadcrumb-separator svg {
            width: 14px;
            height: 14px;
        }

        .breadcrumb-nav .breadcrumb-current {
            color: var(--color-text-primary);
        }

        .page-toolbar {
            display: flex;
            align-items: center;
            height: 50px;
            gap: var(--space-lg);
            align-self: flex-end; /* Position toolbar to the right in vertical breadcrumb layout */
            margin: var(--space-lg) 0;
        }

        .toolbar-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border: none;
            border-radius: var(--border-radius);
            background: transparent;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .toolbar-btn:hover {
            background: transparent;
            color: var(--color-error);
        }

        .toolbar-btn svg {
            width: 24px;
            height: 24px;
        }

        /* ============================================
           CONTENT AREA
           ============================================ */
        #content-area {
            flex: 1 0 auto;
            min-height: 600px;
            background-color: var(--color-white);
        }

        /* ============================================
           CONTACT SECTION
           ============================================ */
        .contact-section {
            background-color: var(--color-surface-dark);
            color: var(--color-white);
            padding-block: var(--space-2xl);
            flex-shrink: 0;
            height: 360px;
        }

        .contact-section .container {
            position: relative;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
        }

        /* Simplified: .contact-content wrapper removed, using .contact-details directly */
        .contact-details {
            flex: 1;
        }

        .contact-section h3 {
            color: var(--color-white);
            font-size: var(--text-h2);
            font-weight: var(--font-weight-normal);
            margin-bottom: var(--space-lg);
        }

        .contact-info {
            font-size: var(--text-body);
            line-height: 1.8;
            font-style: normal;  /* Reset address element default italic */
        }

        .contact-info a {
            color: var(--color-white);
            text-decoration: none;
        }

        .contact-info a:hover {
            text-decoration: underline;
        }

        .contact-copyright {
            display: block;  /* Reset small element default inline */
            margin-top: var(--space-md);
            font-size: var(--text-body);
            max-width: 320px;
            line-height: var(--line-height-normal);
        }

        .scroll-top-btn {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: var(--border-radius);
            color: var(--color-white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            flex-shrink: 0;
            align-self: center;
        }

        .scroll-top-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.5);
        }

        /* ============================================
           FOOTER
           ============================================ */
        footer {
            background-color: var(--color-surface-darker);
            flex-shrink: 0;
            height: var(--footer-height);
            display: flex;
            align-items: center;
        }

        .footer-content {
            max-width: var(--container-max-width);
            margin-inline: auto;
            width: 100%;
            display: flex;
            gap: var(--space-xl);
            padding-inline: var(--container-padding);
        }

        .footer-version {
            color: var(--color-text-muted);
            font-size: var(--text-body-sm);
            margin-left: auto;
        }

        footer a {
            color: var(--color-white);
            font-weight: var(--font-weight-normal);
            font-size: var(--text-body-sm);
            text-decoration: none;
        }

        footer a:hover {
            color: var(--color-border);
            text-decoration: none;
        }

        /* ============================================
           SHARED COMPONENTS
           ============================================ */
        .page-header {
            /* horizontal padding handled by parent .container */
            padding-block: var(--space-xl) var(--space-3xl);
        }

        .page-title {
            font-size: var(--text-display);
            color: var(--color-text-primary);
            margin: 0 0 var(--space-md) 0;
        }

        .page-lead {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
            margin: 0;
        }

        /* Handbook Page - Accordion Style (Swiss Federal CD) */
        .handbook-accordion {
            margin-top: var(--space-xl);
            margin-bottom: var(--space-3xl);
        }

        .accordion-item {
            border-top: 1px solid var(--color-border);
        }

        .accordion-item:last-child {
            border-bottom: 1px solid var(--color-border);
        }

        .accordion-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-lg) 0;
            cursor: pointer;
            background: transparent;
            border: none;
            width: 100%;
            text-align: left;
            font-family: inherit;
            transition: color var(--transition-fast);
        }

        .accordion-header:hover {
            color: var(--color-primary);
        }

        .accordion-title {
            font-size: var(--text-h4);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .accordion-header:hover .accordion-title {
            color: var(--color-primary);
        }

        .accordion-icon {
            width: 24px;
            height: 24px;
            color: var(--color-text-secondary);
            transition: transform var(--transition-fast);
            flex-shrink: 0;
        }

        .accordion-item.open .accordion-icon {
            transform: rotate(180deg);
        }

        .accordion-content {
            display: none;
            padding-bottom: var(--space-xl);
        }

        .accordion-item.open .accordion-content {
            display: block;
        }

        .accordion-description {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-xl);
            line-height: var(--line-height-normal);
        }

        /* Download Item List */
        .download-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: var(--space-xl);
        }

        .download-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
        }

        .download-item__icon {
            width: 24px;
            height: 24px;
            color: var(--color-primary);
            flex-shrink: 0;
            margin-top: 2px;
        }

        .download-item__content {
            flex: 1;
        }

        .download-item__link {
            font-size: var(--text-body);
            font-weight: var(--font-weight-semibold);
            color: var(--color-primary);
            text-decoration: underline;
            display: block;
            margin-bottom: var(--space-xs);
        }

        .download-item__link:hover {
            color: var(--color-primary-dark);
        }

        .download-item__meta {
            font-size: var(--text-body-sm);
            color: var(--color-text-muted);
        }

        .download-item__meta span {
            margin-right: var(--space-sm);
        }

        .download-item__meta span:not(:last-child)::after {
            content: "|";
            margin-left: var(--space-sm);
            color: var(--color-border);
        }

        /* External Link Item */
        .external-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            padding: var(--space-md) 0;
        }

        .external-item__icon {
            width: 20px;
            height: 20px;
            color: var(--color-text-muted);
            flex-shrink: 0;
            margin-top: 2px;
        }

        .external-item__link {
            font-size: var(--text-body);
            color: var(--color-primary);
            text-decoration: underline;
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .external-item__link:hover {
            color: var(--color-primary-dark);
        }

        .external-item__link .external-icon {
            width: 14px;
            height: 14px;
        }

        /* Home Page Hero Section Wrapper */
        .home-hero-section {
            padding-top: var(--space-xl);
            padding-bottom: var(--space-3xl);
            padding-inline: var(--space-lg);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            z-index: var(--z-dropdown);
        }

        /* Themen Section - Light background */
        .home-themen-section {
            background-color: var(--color-bg-light);
            padding: var(--space-3xl) 0;
            position: relative;
            z-index: 1;
        }

        .home-themen-section .home-section {
            margin-top: 0;
            margin-bottom: 0;
            background: transparent;
            /* Preserve margin: 0 auto from .container for horizontal centering */
        }

        /* About Section - BLW Style */
        .home-about-section {
            background-color: var(--color-white);
            padding: var(--space-3xl) 0;
        }

        .about-blw {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-3xl);
            align-items: center;
        }

        @media (max-width: 992px) {
            .about-blw {
                grid-template-columns: 1fr;
                gap: var(--space-xl);
            }
        }

        .about-blw__content h2 {
            font-size: var(--text-h1);
            color: var(--color-text-primary);
            margin: 0 0 var(--space-lg) 0;
            font-weight: var(--font-weight-bold);
            line-height: 1.2;
        }

        .about-blw__content p {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
            margin: 0 0 var(--space-xl) 0;
            line-height: 1.7;
        }

        .about-blw__buttons {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        .about-blw__btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-lg);
            border: 1px solid var(--color-border);
            background: transparent;
            color: var(--color-primary);
            text-decoration: none;
            font-size: var(--text-body);
            font-weight: var(--font-weight-medium);
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .about-blw__btn:hover {
            border-color: var(--color-primary);
            background: var(--color-bg-light);
        }

        .about-blw__btn i {
            width: 18px;
            height: 18px;
        }

        .about-blw__image {
            position: relative;
        }

        .about-blw__image img {
            width: 100%;
            height: auto;
            border-radius: var(--border-radius);
            display: block;
        }

        .about-blw__image-credit {
            position: absolute;
            bottom: var(--space-sm);
            right: var(--space-sm);
            font-size: var(--text-caption);
            color: var(--color-white);
            background: rgba(0,0,0,0.5);
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--border-radius-sm);
        }

        @media (max-width: 992px) {
            .about-blw__image {
                order: -1;
            }
        }

        /* Home Page Hero */
        .home-hero__title {
            font-size: var(--text-display);
            color: var(--color-text-primary);
            margin: 0 0 var(--space-md) 0;
            letter-spacing: -1px;
        }

        .hero__description {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
            margin: 0 0 var(--space-xl) 0;
            font-weight: var(--font-weight-normal);
            line-height: 1.6;
            max-width: 700px;
        }

        /* Home Search Container - for dropdown positioning */
        .home-hero-section .home-search-container {
            max-width: 600px;
            width: 100%;
            position: relative;
            z-index: var(--z-dropdown);
        }

        /* Hero Search Bar - larger search bar for home page */
        .home-search-container .gallery-filter-wrapper {
            height: calc(var(--toolbar-height) * 1.3);
            border-radius: calc(var(--border-radius) * 1.25);
        }

        .home-search-container .gallery-filter-input {
            font-size: var(--text-h5);
            padding: 0 var(--space-lg);
        }

        .home-search-container .gallery-filter-btn {
            width: 64px;
        }


        /* Home Search Dropdown - positioned below home search */
        .home-search-container .search-dropdown {
            margin-top: var(--space-sm);
        }

        /* ============================================
           SEARCH RESULTS PAGE
           ============================================ */
        .search-hero {
            background-color: var(--color-bg-light);
            padding: var(--space-3xl) 0;
        }

        .search-hero__title {
            font-size: var(--text-display);
            color: var(--color-text-primary);
            margin: 0 0 var(--space-xl) 0;
            font-weight: var(--font-weight-bold);
        }

        .search-hero__form {
            max-width: 700px;
        }

        .search-hero__input-wrapper {
            display: flex;
            background: var(--color-white);
            border: 1px solid var(--color-border-input);
            border-radius: var(--border-radius);
            overflow: hidden;
            height: 56px;
        }

        .search-hero__input {
            flex: 1;
            border: none;
            padding: 0 var(--space-lg);
            font-size: var(--text-h4);
            font-family: inherit;
            outline: none;
        }

        .search-hero__submit {
            background: none;
            border: none;
            padding: 0 var(--space-lg);
            cursor: pointer;
            color: var(--color-text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-hero__submit:hover {
            color: var(--color-text-primary);
        }

        .search-hero__submit svg {
            width: 24px;
            height: 24px;
        }

        .search-hero__clear {
            background: none;
            border: none;
            padding: 0 var(--space-md);
            cursor: pointer;
            color: var(--color-text-muted);
            display: none;
            align-items: center;
            justify-content: center;
            transition: color var(--transition-fast);
        }

        .search-hero__clear:hover {
            color: var(--color-text-primary);
        }

        .search-hero__clear.visible {
            display: flex;
        }

        .search-hero__clear svg {
            width: 20px;
            height: 20px;
        }

        /* Search Results Section */
        .search-results {
            padding: var(--space-xl) 0 var(--space-3xl) 0;
        }

        .search-results__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--space-lg);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--color-border);
        }

        .search-results__count {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
        }

        .search-results__controls {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .search-results__sort {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-size: var(--text-body-sm);
            color: var(--color-text-secondary);
            cursor: pointer;
            background: none;
            border: none;
            font-family: inherit;
            padding: var(--space-sm) var(--space-md);
        }

        .search-results__sort:hover {
            color: var(--color-text-primary);
        }

        .search-results__sort svg {
            width: 16px;
            height: 16px;
        }

        /* Search Results List View */
        .search-results__list {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .search-result-item {
            padding: var(--space-lg) 0;
            border-bottom: 1px solid var(--color-border-light);
        }

        .search-result-item__meta {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-sm);
            font-size: var(--text-body-sm);
            color: var(--color-text-muted);
        }

        .search-result-item__type {
            color: var(--color-text-secondary);
        }

        .search-result-item__date::before {
            content: "|";
            margin-right: var(--space-sm);
        }

        .search-result-item__title {
            font-size: var(--text-h4);
            color: var(--color-text-primary);
            margin: 0 0 var(--space-sm) 0;
            font-weight: var(--font-weight-semibold);
        }

        .search-result-item__title a {
            color: inherit;
            text-decoration: none;
        }

        .search-result-item__title a:hover {
            color: var(--color-primary);
        }

        .search-result-item__desc {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
            margin: 0;
            line-height: 1.6;
        }

        /* Search Results Grid View */
        .search-results__grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-lg);
        }

        .search-result-card {
            background: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--space-lg);
            display: flex;
            flex-direction: column;
            transition: box-shadow var(--transition-fast);
        }

        .search-result-card:hover {
            box-shadow: var(--shadow-md);
        }

        .search-result-card__meta {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-md);
            font-size: var(--text-body-sm);
            color: var(--color-text-muted);
        }

        .search-result-card__type {
            color: var(--color-text-secondary);
        }

        .search-result-card__date::before {
            content: "|";
            margin-right: var(--space-sm);
        }

        .search-result-card__title {
            font-size: var(--text-h5);
            color: var(--color-text-primary);
            margin: 0 0 var(--space-sm) 0;
            font-weight: var(--font-weight-semibold);
            line-height: 1.3;
        }

        .search-result-card__title a {
            color: inherit;
            text-decoration: none;
        }

        .search-result-card__title a:hover {
            color: var(--color-primary);
        }

        .search-result-card__desc {
            font-size: var(--text-body-sm);
            color: var(--color-text-secondary);
            margin: 0;
            line-height: 1.5;
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .search-result-card__footer {
            margin-top: var(--space-lg);
            display: flex;
            justify-content: flex-end;
        }

        .search-result-card__link {
            width: 40px;
            height: 40px;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--color-text-muted);
            text-decoration: none;
            transition: all var(--transition-fast);
        }

        .search-result-card__link:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .search-result-card__link svg {
            width: 18px;
            height: 18px;
        }

        /* Search Results Empty State */
        .search-results__empty {
            text-align: center;
            padding: var(--space-3xl) 0;
            color: var(--color-text-muted);
        }

        .search-results__empty-icon {
            margin-bottom: var(--space-lg);
            color: var(--color-border);
        }

        .search-results__empty-icon svg {
            width: 64px;
            height: 64px;
        }

        .search-results__empty-title {
            font-size: var(--text-h4);
            color: var(--color-text-secondary);
            margin: 0 0 var(--space-sm) 0;
        }

        .search-results__empty-text {
            font-size: var(--text-body);
            margin: 0;
        }

        @media (max-width: 992px) {
            .search-results__grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .search-results__grid {
                grid-template-columns: 1fr;
            }

            .search-results__header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-md);
            }

            .search-hero__title {
                font-size: var(--text-h1);
            }

            .search-hero__input {
                font-size: var(--text-body);
            }
        }

        /* ============================================
           HOME PAGE - THEMEN SECTION
           ============================================ */
        .home-section {
            margin-block: var(--space-3xl);
            /* padding handled by .container class */
        }

        .home-section__header {
            margin-bottom: var(--space-xl);
        }

        .home-section__title {
            font-size: var(--text-h2);
            color: var(--color-text-primary);
            font-weight: var(--font-weight-semibold);
            margin: 0;
        }

        .home-section__subtitle {
            font-size: var(--text-body);
            color: var(--color-text-muted);
            margin: var(--space-sm) 0 0 0;
        }

        /* Quick Access Grid */
        .quick-access-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-lg);
        }

        @media (max-width: 1024px) {
            .quick-access-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .quick-access-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Quick Access Card - Matches .card style */
        .quick-card {
            background: var(--color-white);
            border: none;
            border-radius: var(--border-radius);
            padding: var(--space-xl);
            padding-bottom: calc(var(--space-xl) + 48px);
            text-decoration: none;
            display: flex;
            flex-direction: column;
            transition: all var(--transition-normal);
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.04);
            min-height: 200px;
            cursor: pointer;
        }

        .quick-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.06);
        }

        .quick-card__title {
            font-size: var(--text-h4);
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin: 0 0 var(--space-md) 0;
            line-height: var(--line-height-snug);
            transition: color var(--transition-fast);
        }

        .quick-card:hover .quick-card__title {
            color: var(--color-primary);
        }

        .quick-card__desc {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
            margin: 0;
            line-height: var(--line-height-normal);
        }

        .quick-card,
        .quick-card:hover,
        .quick-card *,
        .quick-card:hover * {
            text-decoration: none !important;
        }

        .quick-card__arrow-btn {
            position: absolute;
            bottom: var(--space-lg);
            right: var(--space-lg);
            width: 44px;
            height: 44px;
            border: 1px solid var(--color-primary);
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
        }

        .quick-card__arrow-btn i {
            width: 20px;
            height: 20px;
            color: var(--color-primary);
            transition: color var(--transition-fast);
        }

        .quick-card:hover .quick-card__arrow-btn {
            background: transparent;
            border-color: var(--color-primary);
        }

        .quick-card:hover .quick-card__arrow-btn i {
            color: var(--color-primary);
        }

        /* About Box */
        .about-box {
            background: var(--color-surface);
            border-radius: var(--border-radius-lg);
            padding: var(--space-2xl);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-2xl);
            align-items: center;
        }

        @media (max-width: 768px) {
            .about-box {
                grid-template-columns: 1fr;
                text-align: center;
            }
        }

        .about-box__content h2 {
            font-size: var(--text-h2);
            color: var(--color-text-primary);
            margin: 0 0 var(--space-md) 0;
        }

        .about-box__content p {
            color: var(--color-text-secondary);
            margin: 0 0 var(--space-lg) 0;
            line-height: 1.7;
        }

        .about-box__features {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-md);
        }

        @media (max-width: 768px) {
            .about-box__features {
                justify-content: center;
            }
        }

        .about-box__feature {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            font-size: var(--text-body-sm);
            color: var(--color-text-secondary);
        }

        .about-box__feature i {
            width: 18px;
            height: 18px;
            color: var(--color-interactive);
        }

        .about-box__visual {
            display: flex;
            justify-content: center;
            gap: var(--space-lg);
        }

        .stat-card {
            background: var(--color-white);
            border-radius: var(--border-radius);
            padding: var(--space-lg);
            text-align: center;
            min-width: 120px;
            box-shadow: var(--shadow-sm);
        }

        .stat-card__number {
            font-size: var(--text-h1);
            font-weight: var(--font-weight-bold);
            color: var(--color-interactive);
            margin: 0;
        }

        .stat-card__label {
            font-size: var(--text-caption);
            color: var(--color-text-muted);
            margin: var(--space-xs) 0 0 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* ============================================
           INTRO SECTION - Modern Swiss Design
           ============================================ */
        .intro-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-2xl);
            margin: var(--space-3xl) 0;
            align-items: start;
        }

        @media (max-width: 992px) {
            .intro-section {
                grid-template-columns: 1fr;
                gap: var(--space-xl);
            }
        }

        .intro-card {
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        .intro-card__header {
            background: var(--color-primary);
            padding: var(--space-xs) var(--space-lg);
        }

        .intro-card__body {
            padding: var(--space-xl);
        }

        .intro-card__title {
            font-size: var(--text-h3);
            color: var(--color-text-primary);
            margin-bottom: var(--space-md);
            font-weight: var(--font-weight-semibold);
        }

        .intro-card__text {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
            line-height: 1.7;
            margin-bottom: var(--space-lg);
        }

        .intro-card__text:last-child {
            margin-bottom: 0;
        }

        .intro-card__features {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .intro-card__feature {
            display: flex;
            align-items: flex-start;
            gap: var(--space-sm);
            padding: var(--space-sm) 0;
            color: var(--color-text-secondary);
            font-size: var(--text-body);
        }

        .intro-card__feature [data-lucide] {
            color: var(--color-interactive);
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* Video Container */
        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            background: var(--color-bg-alt);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-caption {
            font-size: var(--text-body-sm);
            color: var(--color-text-muted);
            margin-top: var(--space-md);
            text-align: center;
        }

        /* Info Box Component */
        .info-box {
            background: var(--color-white);
            padding: var(--space-2xl) var(--space-2xl);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            max-width: 900px;
            margin: 0 auto;
            border-top: 5px solid var(--color-primary);
        }

        .info-box--centered {
            text-align: center;
            margin-top: var(--space-xl);
        }

        .info-box__title {
            color: var(--color-text-primary);
            margin-bottom: var(--space-md);
            font-size: var(--text-h2);
            font-weight: var(--font-weight-semibold);
        }

        .info-box__text {
            font-size: var(--text-body);
            color: var(--color-text-secondary);
            line-height: var(--line-height-normal);
        }

        .info-box__icon {
            color: var(--color-text-muted);
            margin-bottom: var(--space-md);
            display: block;
        }

        /* Status/Empty States */
        .status-icon {
            color: var(--color-primary);
            margin-bottom: var(--space-md);
            display: inline-block;
        }

        .status-icon--error {
            color: var(--color-error);
        }

        .empty-text {
            color: var(--color-text-muted);
            padding: var(--space-md);
        }

        .error-detail {
            color: var(--color-text-muted);
            font-size: var(--text-caption);
        }

        /* ============================================
           BUTTON SYSTEM (Swiss Federal Design)
           ============================================ */

        /* Base Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            font-family: var(--font-family-primary);
            font-size: var(--text-body);
            font-weight: var(--font-weight-medium);
            line-height: var(--line-height-normal);
            text-decoration: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all var(--transition-fast);
            border: 1px solid transparent;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Primary Button - Confederation Red */
        .btn--primary {
            background-color: var(--color-primary);
            color: var(--color-white);
            border-color: var(--color-primary);
        }

        .btn--primary:hover:not(:disabled) {
            background-color: var(--color-primary-dark);
            border-color: var(--color-primary-dark);
        }

        .btn--primary:active:not(:disabled),
        .btn--primary.active {
            background-color: var(--color-surface-dark);
            border-color: var(--color-surface-dark);
        }

        /* Secondary Button - Interactive Blue */
        .btn--secondary {
            background-color: var(--color-interactive);
            color: var(--color-white);
            border-color: var(--color-interactive);
        }

        .btn--secondary:hover:not(:disabled) {
            background-color: var(--color-interactive-hover);
            border-color: var(--color-interactive-hover);
        }

        .btn--secondary:active:not(:disabled),
        .btn--secondary.active {
            background-color: var(--color-surface-dark);
            border-color: var(--color-surface-dark);
        }

        /* Outline Button - Primary Red outline */
        .btn--outline {
            background-color: transparent;
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        .btn--outline:hover:not(:disabled) {
            background-color: var(--color-primary);
            color: var(--color-white);
        }

        .btn--outline:active:not(:disabled),
        .btn--outline.active {
            background-color: var(--color-surface-dark);
            border-color: var(--color-surface-dark);
            color: var(--color-white);
        }

        /* Ghost Button */
        .btn--ghost {
            background-color: transparent;
            color: var(--color-text-primary);
            border-color: transparent;
        }

        .btn--ghost:hover:not(:disabled) {
            background-color: var(--color-surface);
        }

        .btn--ghost:active:not(:disabled),
        .btn--ghost.active {
            background-color: var(--color-surface-dark);
            color: var(--color-white);
        }

        /* Button Sizes */
        .btn--sm {
            padding: var(--space-xs) var(--space-sm);
            font-size: var(--text-body-sm);
        }

        .btn--lg {
            padding: var(--space-md) var(--space-lg);
            font-size: var(--text-h4);
        }

        /* ============================================
           TOGGLE SWITCH (Swiss Federal Design)
           ============================================ */

        /* Toggle Switch Container */
        .toggle-switch {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            cursor: pointer;
            user-select: none;
        }

        .toggle-switch__input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* Toggle Track */
        .toggle-switch__track {
            position: relative;
            width: 48px;
            height: 26px;
            background-color: var(--color-border);
            border-radius: 13px;
            transition: background-color var(--transition-fast);
        }

        /* Toggle Thumb */
        .toggle-switch__thumb {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background-color: var(--color-white);
            border-radius: 50%;
            box-shadow: var(--shadow-sm);
            transition: transform var(--transition-fast);
        }

        /* Checked State */
        .toggle-switch__input:checked + .toggle-switch__track {
            background-color: var(--color-surface-dark);
        }

        .toggle-switch__input:checked + .toggle-switch__track .toggle-switch__thumb {
            transform: translateX(22px);
        }

        /* Hover State */
        .toggle-switch:hover .toggle-switch__track {
            background-color: var(--color-text-muted);
        }

        .toggle-switch:hover .toggle-switch__input:checked + .toggle-switch__track {
            background-color: var(--color-surface-darker);
        }

        /* Focus State */
        .toggle-switch__input:focus-visible + .toggle-switch__track {
            outline: 2px solid var(--color-focus);
            outline-offset: 2px;
        }

        /* Disabled State */
        .toggle-switch--disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .toggle-switch--disabled .toggle-switch__track {
            pointer-events: none;
        }

        /* Toggle Label */
        .toggle-switch__label {
            font-size: var(--text-body);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
        }

        /* Small Toggle Variant */
        .toggle-switch--sm .toggle-switch__track {
            width: 36px;
            height: 20px;
            border-radius: 10px;
        }

        .toggle-switch--sm .toggle-switch__thumb {
            width: 14px;
            height: 14px;
            top: 3px;
            left: 3px;
        }

        .toggle-switch--sm .toggle-switch__input:checked + .toggle-switch__track .toggle-switch__thumb {
            transform: translateX(16px);
        }

        .toggle-switch--sm .toggle-switch__label {
            font-size: var(--text-body-sm);
        }

        /* ============================================
           FORM ELEMENTS
           ============================================ */

        .form-input {
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--space-sm) var(--space-md);
            font-size: var(--text-body);
            font-family: var(--font-family-primary);
            background-color: var(--color-white);
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
            width: 100%;
        }

        .form-input:focus {
            border-color: var(--color-focus);
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 175, 233, 0.25);
        }

        .form-input:invalid {
            border-color: var(--color-error);
        }

        .form-label {
            font-size: var(--text-label);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            margin-bottom: var(--space-xs);
            display: block;
        }

        /* ============================================
           SEARCH BAR
           ============================================ */
        .gallery-filter-container {
            margin: 0 auto var(--space-lg) auto;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-md);
        }

        .gallery-filter-left {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .gallery-filter-container .gallery-filter-wrapper {
            width: 400px;
            flex-shrink: 0;
            height: var(--toolbar-height);
        }

        .gallery-filter-wrapper {
            display: flex;
            height: calc(var(--toolbar-height)*1.1);
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 1px solid var(--color-border-input);
            background: var(--color-white);
            transition: border-color var(--transition-fast);
        }

        .gallery-filter-wrapper:focus-within {
            border-color: var(--color-focus-input);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
        }

        .gallery-filter-input {
            flex: 1;
            padding: 0 var(--space-md);
            font-size: var(--text-body);
            border: none;
            outline: none;
            background: transparent;
            font-family: var(--font-family-primary);
        }

        .gallery-filter-input:focus {
            outline: none;
        }

        .gallery-filter-btn {
            width: 56px;
            background: transparent;
            color: var(--color-text-muted);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color var(--transition-fast);
        }

        .gallery-filter-btn:hover {
            color: var(--color-text-primary);
        }

        /* Clear Input Button */
        .search-clear-btn {
            background: none;
            border: none;
            padding: 0 var(--space-sm);
            cursor: pointer;
            color: var(--color-text-muted);
            display: none;
            align-items: center;
            justify-content: center;
            transition: color var(--transition-fast);
        }

        .search-clear-btn:hover {
            color: var(--color-text-primary);
        }

        .search-clear-btn.visible {
            display: flex;
        }

        .search-clear-btn svg {
            width: 18px;
            height: 18px;
        }

        /* ============================================
           GLOBAL SEARCH DROPDOWN (Homepage)
           ============================================ */
        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.06);
            max-height: 400px;
            overflow-y: auto;
            z-index: var(--z-dropdown);
            display: none;
            text-align: left;
            margin-top: var(--space-xs);
        }

        .search-dropdown.open {
            display: block;
        }

        .search-dropdown-group {
            border-bottom: 1px solid var(--color-border-light);
        }

        .search-dropdown-group:last-child {
            border-bottom: none;
        }

        .search-dropdown-header {
            font-size: var(--text-body-sm);
            color: var(--color-text-secondary);
            padding: var(--space-sm) var(--space-lg);
            background: var(--color-bg-light);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .search-dropdown-item {
            display: block;
            padding: var(--space-sm) var(--space-lg);
            color: var(--color-text-primary);
            font-size: var(--text-body);
            cursor: pointer;
            transition: background-color var(--transition-fast), color var(--transition-fast);
            text-decoration: none;
            border-bottom: 1px solid var(--color-border-light);
        }

        .search-dropdown-group .search-dropdown-item:last-child {
            border-bottom: none;
        }

        .search-dropdown-item:hover {
            background-color: var(--color-surface);
            color: var(--color-primary);
        }

        .search-dropdown-empty {
            padding: var(--space-xl);
            text-align: center;
            color: var(--color-text-secondary);
            font-size: var(--text-body);
        }

        .search-dropdown-footer {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-xs);
            padding: var(--space-md) var(--space-lg);
            background: var(--color-bg-light);
            color: var(--color-primary);
            font-size: var(--text-body-sm);
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: background-color var(--transition-fast), color var(--transition-fast);
            border-top: 1px solid var(--color-border-light);
        }

        .search-dropdown-footer:hover {
            background: rgba(220, 0, 24, 0.08);
            color: var(--color-primary);
        }

        .search-dropdown-footer svg {
            width: 16px;
            height: 16px;
            pointer-events: none;
        }

        /* ============================================
           TAG BADGE (Universal)
           ============================================ */
        .tag-badge {
            display: inline-flex;
            align-items: center;
            background: var(--color-white);
            color: var(--color-text-primary);
            border: 1px solid var(--color-border-input);
            font-size: var(--text-body-sm);
            font-weight: var(--font-weight-medium);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--border-radius-full);
            font-family: var(--font-family-primary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .tag-badge:hover {
            background-color: var(--color-bg-light);
            border-color: var(--color-text-muted);
        }

        /* Active tag state */
        .tag-badge.active {
            background: var(--color-surface-dark);
            color: var(--color-white);
        }

        .tag-badge.active:hover {
            background: var(--color-surface-darker);
        }

        /* Count badge for +N / - toggle */
        .tag-badge--count {
            background: var(--color-bg-light);
            color: var(--color-text-muted);
            border-color: var(--color-border);
            min-width: 2rem;
            justify-content: center;
        }

        .tag-badge--count:hover {
            background: var(--color-bg-muted);
            color: var(--color-text-primary);
        }

        /* ============================================
           ALERT SYSTEM
           ============================================ */
        .alert {
            padding: var(--space-md);
            border-radius: var(--border-radius);
            border-left: 4px solid;
            margin-bottom: var(--space-md);
        }

        .alert--info {
            background-color: var(--color-info-bg);
            border-left-color: var(--color-info);
            color: var(--color-info);
        }

        .alert--success {
            background-color: var(--color-success-bg);
            border-left-color: var(--color-success);
            color: var(--color-success);
        }

        .alert--warning {
            background-color: var(--color-warning-bg);
            border-left-color: var(--color-warning);
            color: var(--color-warning);
        }

        .alert--error {
            background-color: var(--color-error-bg);
            border-left-color: var(--color-error);
            color: var(--color-error);
        }


        .toolbar-control {
            height: var(--toolbar-height);
            display: flex;
            align-items: center;
            background: var(--color-white);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border-input);
            padding: var(--space-sm);
            position: relative;
        }


        /* View Switcher */
        .view-switcher {
            gap: 0;
            padding: 0;
            border: 1px solid var(--color-border-input);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .view-btn {
            border: none;
            background: var(--color-white);
            color: var(--color-text-secondary);
            padding: 0;
            cursor: pointer;
            border-radius: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            height: calc(var(--toolbar-height) - 2px);
            width: 42px;
            transition: all var(--transition-fast);
        }

        .view-btn:hover {
            color: var(--color-text-primary);
            background: var(--color-bg-light);
        }

        .view-btn.active {
            background: var(--color-surface-dark);
            color: var(--color-white);
        }

        .view-btn.active:hover {
            background: var(--color-surface-darker);
        }

        .view-btn + .view-btn {
            border-left: 1px solid var(--color-border-light);
        }

        /* Filter Button */
        .filter-btn {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            background: var(--color-white);
            border: 1px solid var(--color-border-input);
            border-radius: var(--border-radius);
            padding: 0 var(--space-md);
            height: var(--toolbar-height);
            font-family: var(--font-family-primary);
            font-size: var(--text-body-sm);
            transition: all var(--transition-fast);
        }

        .filter-btn:hover {
            border-color: var(--color-text-muted);
            background: var(--color-bg-light);
        }

        .filter-btn.active {
            background: var(--color-surface-dark);
            color: var(--color-white);
            border-color: var(--color-surface-dark);
        }

        .filter-btn.active:hover {
            background: var(--color-surface-darker);
            border-color: var(--color-surface-darker);
        }

        /* Reset Filter Button - extends filter-btn with danger hover */
        .reset-filter-btn {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            background: var(--color-white);
            border: 1px solid var(--color-border-input);
            border-radius: var(--border-radius);
            padding: 0 var(--space-md);
            height: var(--toolbar-height);
            font-family: var(--font-family-primary);
            font-size: var(--text-body-sm);
            transition: all var(--transition-fast);
        }

        .reset-filter-btn:hover {
            color: var(--color-primary);
            border-color: var(--color-primary);
            background: var(--color-white);
        }

        /* Filter Count Badge */
        .filter-count-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--color-text-primary);
            color: var(--color-white);
            font-size: var(--text-caption);
            font-weight: var(--font-weight-semibold);
            min-width: 20px;
            height: 20px;
            padding: 0 var(--space-xs);
            border-radius: 10px;
            margin-left: var(--space-xs);
        }

        /* Floating filter count badge */
        .toolbar-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--color-primary);
            color: var(--color-white);
            font-size: var(--text-caption);
            font-weight: var(--font-weight-bold);
            min-width: var(--space-lg);
            height: var(--space-lg);
            padding: 0 var(--space-xs);
            border-radius: var(--border-radius-full);
            line-height: 1;
            box-sizing: border-box;
            z-index: 10;
        }

        /* ============================================
           CATALOG LAYOUT
           ============================================ */
        /* Simplified: .catalog-layout wrapper removed, using .catalog-content directly */
        .catalog-content {
            flex: 1;
            min-width: 0;
            margin-bottom: var(--space-3xl);
        }

        /* Filter Bar (Horizontal) */
        .filter-bar {
            background: var(--color-white);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border-input);
            margin-bottom: var(--space-xl);
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-bar.closed {
            display: none;
        }

        .filter-bar__header {
            background: var(--color-surface);
            padding: var(--space-md) var(--space-lg);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            border-right: 1px solid var(--color-border-light);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .filter-bar__reset {
            background: none;
            border: none;
            color: var(--color-text-muted);
            padding: var(--space-xs);
            cursor: pointer;
            transition: color var(--transition-fast);
            font-family: var(--font-family-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-sm);
        }

        .filter-bar__reset:hover {
            color: var(--color-primary);
            background: var(--color-bg-light);
        }

        .filter-bar__reset [data-lucide] {
            width: 18px;
            height: 18px;
        }

        .filter-bar__groups {
            display: flex;
            flex: 1;
            flex-wrap: wrap;
        }

        .filter-group {
            border-right: 1px solid var(--color-border-light);
        }

        .filter-group:last-child {
            border-right: none;
        }

        .filter-toggle {
            padding: var(--space-md) var(--space-lg);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            cursor: pointer;
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            transition: background var(--transition-fast);
            font-size: var(--text-body-sm);
            white-space: nowrap;
        }

        .filter-toggle:hover {
            background: var(--color-bg-light);
        }

        .filter-toggle [data-lucide] {
            width: 16px;
            height: 16px;
            color: var(--color-text-muted);
        }

        @media (max-width: 768px) {
            .filter-bar {
                flex-direction: column;
                align-items: stretch;
            }

            .filter-bar__header {
                border-right: none;
                border-bottom: 1px solid var(--color-border-light);
            }

            .filter-bar__groups {
                flex-direction: column;
            }

            .filter-group {
                border-right: none;
                border-bottom: 1px solid var(--color-border-light);
            }

            .filter-group:last-child {
                border-bottom: none;
            }
        }

        /* Filter Group with Dropdown */
        .filter-group {
            position: relative;
        }

        .filter-group.open .filter-toggle {
            background: var(--color-bg-light);
        }

        .filter-group.open .filter-toggle [data-lucide] {
            transform: rotate(180deg);
        }

        .filter-toggle [data-lucide] {
            transition: transform var(--transition-fast);
        }

        .filter-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            min-width: 280px;
            max-width: 400px;
            max-height: 320px;
            overflow-y: auto;
            background: var(--color-white);
            border: 1px solid var(--color-border-input);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: 100;
            display: none;
            padding: var(--space-md);
        }

        .filter-group.open .filter-dropdown {
            display: block;
        }

        .filter-dropdown__title {
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-sm);
            padding-bottom: var(--space-xs);
            border-bottom: 1px solid var(--color-border-light);
        }

        .filter-dropdown__items {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-xs);
        }

        .filter-dropdown__item {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: var(--space-xs) var(--space-sm);
            background: var(--color-surface);
            border: 1px solid var(--color-border-light);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            transition: all var(--transition-fast);
        }

        .filter-dropdown__item:hover {
            background: var(--color-bg-light);
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .filter-dropdown__item.active {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: var(--color-white);
        }

        .filter-dropdown__item.active:hover {
            background: var(--color-primary-hover);
        }

        .filter-dropdown__count {
            font-size: var(--font-size-xs);
            color: var(--color-text-muted);
            background: var(--color-surface);
            padding: 1px 6px;
            border-radius: 10px;
        }

        .filter-dropdown__item.active .filter-dropdown__count {
            background: rgba(255,255,255,0.2);
            color: var(--color-white);
        }

        /* Phase filter specific styles */
        .filter-dropdown__phases {
            display: flex;
            flex-direction: column;
            gap: var(--space-xs);
        }

        .filter-dropdown__phase-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm);
            background: var(--color-surface);
            border: 1px solid var(--color-border-light);
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .filter-dropdown__phase-item:hover {
            background: var(--color-bg-light);
            border-color: var(--color-primary);
        }

        .filter-dropdown__phase-item.active {
            background: var(--color-primary-light);
            border-color: var(--color-primary);
        }

        .filter-dropdown__phase-number {
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--color-white);
            border: 2px solid var(--color-border-light);
            border-radius: 50%;
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        .filter-dropdown__phase-item.active .filter-dropdown__phase-number {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: var(--color-white);
        }

        .filter-dropdown__phase-label {
            flex: 1;
            font-size: var(--font-size-sm);
            color: var(--color-text-primary);
        }

        /* Mobile adjustments for filter dropdowns */
        @media (max-width: 768px) {
            .filter-dropdown {
                position: fixed;
                top: auto;
                bottom: 0;
                left: 0;
                right: 0;
                min-width: 100%;
                max-width: 100%;
                max-height: 60vh;
                border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            }
        }

        /* ============================================
           GRID VIEW (Card Component - Swiss CD Style)
           ============================================ */
        .element-grid {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--space-xl);
        }

        /* Card Component - Swiss Federal CD Style */
        .card {
            background: var(--color-white);
            border-radius: var(--border-radius);
            overflow: hidden;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.04);
            border: none;
            transition: all var(--transition-normal);
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.06);
        }

        .card:hover .card__title {
            color: var(--color-primary);
        }

        .card:hover .card__arrow-btn {
            background: transparent;
            border-color: var(--color-primary);
        }

        .card:hover .card__arrow-btn svg {
            stroke: var(--color-primary);
        }

        .card__image {
            height: 200px;
            background: var(--color-bg-light);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        /* Floating tag on card image */
        .card__image .tag-badge {
            position: absolute;
            top: var(--space-md);
            left: var(--space-md);
            z-index: 10;
            box-shadow: var(--shadow-sm);
        }

        .card__image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .placeholder-icon {
            color: var(--color-border);
        }

        /* .card__content wrapper removed - .card__body and .card__footer are now direct children */

        .card__body {
            padding: var(--space-lg) var(--space-lg) var(--space-md);
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .card__date {
            font-size: var(--text-body-sm);
            color: var(--color-text-light);
            margin: 0 0 var(--space-sm) 0;
        }

        .card__title {
            margin: 0 0 var(--space-sm) 0;
            font-size: var(--text-h4);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-snug);
            color: var(--color-text-primary);
            transition: color var(--transition-fast);
        }

        .card__subtitle {
            font-size: var(--text-body);
            color: var(--color-text-primary);
            margin: 0;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: var(--line-height-relaxed);
        }

        .card__tags {
            margin-top: var(--space-md);
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }

        .card__footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md) var(--space-lg) var(--space-lg);
            background: transparent; /* Override generic footer styling */
        }

        .card__footer--end {
            justify-content: flex-end;
        }

        .card__arrow-btn {
            width: 44px;
            height: 44px;
            border: 1px solid var(--color-primary);
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .card__arrow-btn svg {
            width: 20px;
            height: 20px;
            stroke: var(--color-primary);
            stroke-width: 2;
            fill: none;
            transition: stroke var(--transition-fast);
        }

        .card__arrow-btn:hover {
            background: transparent;
            border-color: var(--color-primary);
        }

        .card__arrow-btn:hover svg {
            stroke: var(--color-primary);
        }

        /* ============================================
           LIST VIEW
           ============================================ */
        .element-list-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            overflow: hidden;
            background: var(--color-white);
            box-shadow: var(--shadow-sm);
        }

        /* Header Row */
        .list-header-row {
            display: flex;
            align-items: center;
            background: var(--color-surface);
            color: var(--color-text-primary);
            padding: var(--space-sm) var(--space-md);
            font-weight: var(--font-weight-semibold);
            font-size: var(--text-body-sm);
            border-bottom: 2px solid var(--color-border);
        }

        /* Data Row */
        .element-list-item {
            display: flex;
            align-items: center;
            background: var(--color-white);
            border-bottom: 1px solid var(--color-border-light);
            padding: var(--space-sm) var(--space-md);
            transition: background-color var(--transition-fast);
            cursor: pointer;
        }

        .element-list-item:last-child {
            border-bottom: none;
        }

        .element-list-item:hover {
            background-color: var(--color-surface);
        }

        /* Column Layout */
        .list-col-name {
            width: 20%;
            font-size: var(--text-body-sm);
            flex-shrink: 0;
        }

        .list-col-desc {
            flex: 1;
            font-size: var(--text-body-sm);
            padding-right: var(--space-md);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .list-col-tags {
            width: 450px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: var(--space-sm);
            flex-wrap: wrap;
            flex-shrink: 0;
        }

        /* Data row text colors */
        .element-list-item .list-col-name {
            color: var(--color-text-primary);
        }

        .element-list-item .list-col-desc {
            color: var(--color-text-secondary);
        }

        /* ============================================
           DETAIL VIEW
           ============================================ */
        /* Simplified: merged .detail-hero-wrapper and .detail-hero */
        .detail-hero {
            background: var(--color-bg-light);
            padding: var(--space-2xl) 0 var(--space-2xl) 0;
            margin-bottom: var(--space-3xl);
        }

        .detail-hero__inner {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-2xl);
        }

        .hero-content {
            flex: 1;
        }

        .breadcrumb {
            margin-bottom: var(--space-lg);
            color: var(--color-text-secondary);
            font-size: var(--text-body-sm);
            font-weight: var(--font-weight-medium);
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .hero-title {
            font-size: var(--text-display);
            margin-bottom: var(--space-md);
            color: var(--color-text-primary);
            letter-spacing: -1px;
            line-height: var(--line-height-tight);
            font-weight: var(--font-weight-bold);
        }

        .hero-subtitle {
            font-size: var(--text-h3);
            color: var(--color-text-primary);
            line-height: var(--line-height-normal);
            max-width: 700px;
            margin-bottom: var(--space-lg);
            font-weight: var(--font-weight-normal);
        }

        .hero-tags {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
            margin-top: var(--space-md);
        }

        .hero-image-container {
            flex: 0 0 50%;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--color-surface);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 1px solid var(--color-border-light);
        }

        .hero-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .hero-image-placeholder {
            color: var(--color-border);
        }

        /* Detail Layout */
        .detail-layout {
            display: flex;
            gap: var(--space-3xl);
            align-items: flex-start;
        }

        .detail-sidebar {
            width: 220px;
            flex-shrink: 0;
            position: sticky;
            top: var(--space-md);
        }

        .sticky-nav {
            display: flex;
            flex-direction: column;
            border-left: 2px solid var(--color-border);
        }

        .sticky-nav a {
            padding: var(--space-sm) var(--space-md);
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
            border-left: 3px solid transparent;
            margin-left: -2px;
            cursor: pointer;
            text-decoration: none;
            transition: all var(--transition-fast);
        }

        .sticky-nav a:hover {
            color: var(--color-primary);
        }

        .sticky-nav a.active {
            border-left-color: var(--color-primary);
            color: var(--color-primary);
            font-weight: var(--font-weight-bold);
        }

        .detail-content-area {
            flex: 1;
            min-width: 0;
            padding-bottom: 100px;
        }

        .detail-section {
            margin-bottom: var(--space-3xl);
            scroll-margin-top: var(--space-3xl);
        }

        .detail-section h2 {
            font-size: var(--text-h2);
            color: var(--color-text-primary);
            margin-bottom: var(--space-lg);
            border-bottom: 1px solid var(--color-border);
            padding-bottom: var(--space-md);
        }

        .detail-section p {
            font-size: var(--text-body);
            line-height: 1.7;
            color: var(--color-text-primary);
            margin-bottom: var(--space-md);
        }

        /* ============================================
           DATA TABLES (Swiss Federal Style)
           ============================================ */
        .table,
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            overflow: hidden;
            background: var(--color-white);
            margin-bottom: var(--space-md);
            table-layout: fixed;
        }

        .table th,
        .data-table th {
            background: var(--color-surface);
            color: var(--color-text-primary);
            font-weight: var(--font-weight-semibold);
            text-align: left;
            padding: var(--space-sm) var(--space-md);
            font-size: var(--text-body-sm);
            border-bottom: 2px solid var(--color-border);
            vertical-align: middle;
        }

        .table td,
        .data-table td {
            padding: var(--space-sm) var(--space-md);
            border-bottom: 1px solid var(--color-border-light);
            color: var(--color-text-secondary);
            vertical-align: top;
            overflow-wrap: break-word;
        }

        .table tr:last-child td,
        .data-table tr:last-child td {
            border-bottom: none;
        }

        .table tr:hover td,
        .data-table tr:hover td {
            background-color: var(--color-surface);
        }

        /* Table Modifiers (BEM) */
        .table--striped tbody tr:nth-child(even) td {
            background-color: var(--color-surface);
        }

        .table--striped tbody tr:nth-child(even):hover td {
            background-color: var(--color-surface-alt);
        }

        .table--compact th,
        .table--compact td {
            padding: var(--space-xs) var(--space-sm);
            font-size: var(--text-body-sm);
        }

        .table--bordered td {
            border: 1px solid var(--color-border-light);
        }

        .table--bordered th {
            border: 1px solid var(--color-border);
        }

        /* Table Column Widths */
        .th-w-20 { width: 20%; }
        .th-w-format { width: 100px; }
        .th-w-list { width: 80px; text-align: center !important; }
        .th-w-phases { width: 200px; text-align: center !important; }

        /* Table Cell Utilities */
        .col-val { font-size: var(--text-body-sm); }
        .col-center { text-align: center; }

        .list-icon-active {
            color: var(--color-surface-dark);
            width: 22px;
            height: 22px;
        }

        /* Phase Badges */
        .phase-compact-wrapper {
            display: flex;
            gap: var(--space-xs);
            justify-content: center;
        }

        .phase-badge {
            width: 22px;
            height: 22px;
            border-radius: var(--border-radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--text-caption);
            font-weight: var(--font-weight-bold);
            border: 1px solid var(--color-border-light);
            color: var(--color-text-muted);
            background: var(--color-surface);
            cursor: help;
            transition: all var(--transition-fast);
        }

        .phase-badge.active {
            background: var(--color-surface-dark);
            color: var(--color-white);
            border-color: var(--color-surface-dark);
        }

        /* Usecase Detail Page Styles */
        .phases-container {
            display: flex;
            gap: var(--space-xs);
            flex-wrap: wrap;
        }

        .phases-container--large .phase-badge {
            width: 32px;
            height: 32px;
            font-size: var(--text-sm);
        }

        .phase-badge.inactive {
            opacity: 0.4;
        }

        .col-actor {
            font-weight: var(--font-weight-semibold);
            vertical-align: top;
        }

        .info-box--inline {
            display: flex;
            align-items: flex-start;
            gap: var(--space-md);
            padding: var(--space-lg);
            background: var(--color-surface);
            border: 1px solid var(--color-border-light);
            border-radius: var(--border-radius-lg);
        }

        .info-box--inline .info-box__icon {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            color: var(--color-text-muted);
        }

        .info-box--inline .info-box__text {
            margin: 0;
            color: var(--color-text-secondary);
        }

        .bpmn-viewer-container {
            width: 100%;
            height: 500px;
            border: 1px solid var(--color-border-light);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            background: var(--color-white);
        }

        .bpmn-viewer-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Tooltip Name Style for Informationen Table */
        .info-name-tooltip {
            text-decoration: underline;
            text-decoration-style: dotted;
            text-underline-offset: 3px;
            cursor: help;
        }

        /* ============================================
           STATE INDICATORS
           ============================================ */
        .loading-state,
        .error-state {
            padding: var(--space-3xl) var(--space-md);
            text-align: center;
            color: var(--color-text-secondary);
        }

        .loading-spinner {
            width: 36px;
            height: 36px;
            color: var(--color-primary);
            animation: spin 1s linear infinite;
            margin-bottom: var(--space-md);
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: var(--space-2xl);
            color: var(--color-text-secondary);
            border: 1px dashed var(--color-border);
            border-radius: var(--border-radius);
            background: var(--color-white);
        }

        .no-results h3 {
            color: var(--color-text-primary);
            margin-bottom: var(--space-sm);
        }

        .no-results .clear-filter-link {
            color: var(--color-primary);
            cursor: pointer;
            text-decoration: underline;
        }

        .no-results .clear-filter-link:hover {
            color: var(--color-primary-light);
        }

        /* ============================================
           RESPONSIVE (Mobile-first breakpoints)
           ============================================ */

        /* Tablet and below (max-width: 992px) */
        @media (max-width: 992px) {
            :root {
                --container-padding: var(--space-lg);  /* 24px on tablet */
            }

            /* Header responsive */
            .header__top {
                padding-block: var(--space-md);
                /* padding-inline inherits from --container-padding */
                flex-wrap: wrap;
                gap: var(--space-md);
            }

            .header__logo {
                width: 34px;
                height: 34px;
            }

            .header__separator {
                height: 48px;
                margin: 0 var(--space-md);
            }

            .header__title {
                font-size: var(--text-body);
            }

            .header__controls {
                position: absolute;
                top: var(--space-md);
                right: var(--container-padding);
            }

            .header__search.open .header__search-form {
                width: 200px;
            }

            .main-nav .container {
                /* padding-inline inherits from --container-padding */
            }

            .main-nav ul {
                gap: var(--space-lg);
            }

            .detail-layout {
                flex-direction: column;
            }

            .detail-sidebar {
                width: 100%;
                margin-bottom: var(--space-md);
                position: static;
            }

            .hero-image-container {
                display: none;
            }

            .detail-hero {
                flex-direction: column;
            }

            .sticky-nav {
                flex-direction: row;
                overflow-x: auto;
                border-left: none;
                border-bottom: 2px solid var(--color-border);
                padding-bottom: var(--space-sm);
            }

            .sticky-nav a {
                border-left: none;
                border-bottom: 3px solid transparent;
                margin-bottom: -12px;
                white-space: nowrap;
            }

            .sticky-nav a.active {
                border-left: none;
                border-bottom-color: var(--color-primary);
            }

            /* Responsive Tables */
            .data-table,
            .table {
                display: block;
                overflow-x: auto; 
            }

            .th-w-20 { min-width: 150px; }
            .th-w-phases { min-width: 180px; }
            .th-w-format { min-width: 100px; }
            .th-w-list { min-width: 60px; }

            /* List View Mobile */
            .list-header-row {
                display: none;
            }

            .element-list-item {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-sm);
            }

            .list-col-name,
            .list-col-desc,
            .list-col-tags {
                width: 100%;
            }

            .list-col-desc {
                white-space: normal;
                padding-right: 0;
            }

            /* Toolbar responsive */
            .toolbar-control {
                height: auto;
                padding: var(--space-xs);
            }

            /* Contact section responsive */
            .contact-section {
                height: auto;
                min-height: 370px;
                /* padding-inline handled by child .container */
            }

            .scroll-top-btn {
                right: var(--container-padding);
                top: auto;
                bottom: var(--space-lg);
                transform: none;
            }
        }

        /* Mobile (max-width: 576px) */
        @media (max-width: 576px) {
            :root {
                --container-padding: var(--space-md);  /* Reduce container padding on mobile */
            }

            /* Header mobile */
            .header__top {
                padding-block: var(--space-md);
                /* padding-inline inherits from --container-padding */
            }

            .header__branding {
                flex-wrap: wrap;
            }

            .header__logo {
                width: 34px;
                height: 34px;
            }

            .header__confederation {
                font-size: 10px;
            }

            .header__separator {
                display: none;
            }

            .header__title {
                width: 100%;
                margin-top: var(--space-sm);
                padding-top: var(--space-sm);
                border-top: 1px solid var(--color-border-light);
                font-size: var(--text-body);
            }

            .header__controls {
                position: absolute;
                top: var(--space-md);
                right: var(--space-md);
            }

            .header__links {
                display: none;
            }

            .header__search.open .header__search-form {
                width: 180px;
            }

            .main-nav .container {
                /* padding-inline inherits from --container-padding */
            }

            .main-nav ul {
                gap: var(--space-md);
                overflow-x: auto;
                flex-wrap: nowrap;
                padding-bottom: var(--space-xs);
            }

            .nav-link {
                white-space: nowrap;
                font-size: var(--text-body-sm);
            }

            /* .container padding-inline inherits from --container-padding variable */

            .page-title {
                font-size: var(--text-h1);
            }

            .hero-title {
                font-size: var(--text-h1);
            }

            .hero-subtitle {
                font-size: var(--text-body);
            }

            .gallery-filter-input {
                padding: var(--space-sm) var(--space-md);
                font-size: var(--text-body);
            }

            .element-grid {
                grid-template-columns: 1fr;
                gap: var(--space-md);
            }
        }

        /* ============================================
           SWISS FEDERAL DESIGN SYSTEM - COMPONENTS
           Source: Official Swiss Government CSS Library
           ============================================ */

        /* ============================================
           SORTABLE TABLE HEADERS
           ============================================ */
        .table__sorter {
            display: inline-flex;
            align-items: baseline;
            text-align: left;
            background: none;
            border: none;
            padding: 0;
            font: inherit;
            text-transform: inherit;
            font-weight: inherit;
            color: inherit;
            cursor: pointer;
            transition: color var(--transition-fast);
        }

        .table__sorter:hover {
            color: var(--color-primary);
        }

        .text-right .table__sorter {
            justify-content: flex-end;
            text-align: right;
        }

        .table__sorter span::after {
            content: '↕';
            display: block;
            margin-left: var(--space-xs);
            min-width: 1.25em;
            font-weight: var(--font-weight-normal);
            font-size: var(--text-caption);
            text-align: center;
            opacity: 0.5;
        }

        th[aria-sort='descending'] .table__sorter span::after {
            content: '▼';
            opacity: 1;
            color: var(--color-primary);
        }

        th[aria-sort='ascending'] .table__sorter span::after {
            content: '▲';
            opacity: 1;
            color: var(--color-primary);
        }

        /* ============================================
           ACCORDION (Swiss Federal Design)
           ============================================ */
        .accordion {
            padding-left: 0;
            list-style: none;
            margin: 0;
        }

        .accordion--spaced {
            padding: var(--space-xl) 0;
        }

        .accordion__item {
            border-top: 1px solid var(--color-border-light);
            list-style: none;
            margin-top: 0;
        }

        .accordion__item:last-of-type {
            border-bottom: 1px solid var(--color-border-light);
        }

        .accordion__button {
            display: flex;
            align-items: center;
            width: 100%;
            padding: var(--space-md) var(--space-sm);
            background: none;
            border: none;
            font-family: var(--font-family-primary);
            font-size: var(--text-body);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            text-align: left;
            cursor: pointer;
            transition: color var(--transition-fast);
        }

        .accordion__button:hover {
            color: var(--color-primary);
        }

        .accordion__button:focus-visible {
            outline: 2px solid var(--color-focus);
            outline-offset: -2px;
        }

        .accordion__button[aria-expanded="true"] {
            color: var(--color-primary);
        }

        .accordion__title {
            flex: 1;
            padding-right: var(--space-md);
        }

        .accordion__arrow {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            margin-left: auto;
            transition: transform var(--transition-normal);
            flex-shrink: 0;
        }

        .accordion__button[aria-expanded="true"] .accordion__arrow {
            transform: rotate(180deg);
        }

        .accordion__drawer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .accordion__drawer.active,
        .accordion__drawer[aria-hidden="false"] {
            max-height: 2000px; /* Large enough for content */
            transition: max-height 0.5s ease-in;
        }

        .accordion__content {
            padding: var(--space-sm) var(--space-sm) var(--space-xl) var(--space-sm);
        }

        .accordion__content > *:last-child {
            margin-bottom: 0;
        }

        /* ============================================
           PAGINATION (Swiss Federal Design)
           ============================================ */
        .pagination {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-lg) 0;
        }

        .pagination--right {
            justify-content: flex-end;
        }

        .pagination--left {
            justify-content: flex-start;
        }

        .pagination__list {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .pagination__item {
            margin: 0;
        }

        .pagination__link {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
            height: 36px;
            padding: 0 var(--space-sm);
            font-size: var(--text-body-sm);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-secondary);
            background: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            text-decoration: none;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .pagination__link:hover:not(.pagination__link--disabled):not(.pagination__link--active) {
            background: var(--color-surface);
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .pagination__link--active {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: var(--color-white);
            font-weight: var(--font-weight-semibold);
            cursor: default;
        }

        .pagination__link--disabled {
            color: var(--color-text-muted);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .pagination__ellipsis {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
            height: 36px;
            color: var(--color-text-muted);
        }

        .pagination__text {
            font-size: var(--text-body-sm);
            color: var(--color-text-secondary);
            margin: 0 var(--space-sm);
        }

        .pagination__input {
            width: 60px;
            height: 36px;
            text-align: center;
            padding: 0 var(--space-sm);
            font-size: var(--text-body-sm);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
        }

        .pagination__input:focus {
            border-color: var(--color-focus);
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 175, 233, 0.25);
        }

        /* ============================================
           MODAL (Swiss Federal Design)
           ============================================ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: var(--z-modal);
            padding: 5vh var(--space-md);
            overflow-y: auto;
        }

        .modal.active,
        .modal[open="true"] {
            display: block;
        }

        .modal__backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: var(--z-modal-backdrop);
            cursor: pointer;
        }

        .modal__content {
            position: relative;
            z-index: var(--z-modal);
            max-width: 600px;
            max-height: 90vh;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            background: var(--color-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .modal--sm .modal__content { max-width: 400px; }
        .modal--md .modal__content { max-width: 600px; }
        .modal--lg .modal__content { max-width: 800px; }
        .modal--xl .modal__content { max-width: 1000px; }
        .modal--full .modal__content { max-width: calc(100% - var(--space-xl)); }

        .modal__header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-md) var(--space-lg);
            border-bottom: 1px solid var(--color-border-light);
            background: var(--color-surface);
        }

        .modal__title {
            font-size: var(--text-h3);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            margin: 0;
        }

        .modal__close {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            padding: 0;
            background: none;
            border: none;
            border-radius: var(--border-radius);
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .modal__close:hover {
            background: var(--color-bg-alt);
            color: var(--color-text-primary);
        }

        .modal__body {
            flex: 1;
            padding: var(--space-lg);
            overflow-y: auto;
        }

        .modal__body > *:last-child {
            margin-bottom: 0;
        }

        .modal__footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-lg);
            border-top: 1px solid var(--color-border-light);
            background: var(--color-surface);
        }

        /* ============================================
           TOAST MESSAGES (Swiss Federal Design)
           ============================================ */
        .toast-container {
            position: fixed;
            bottom: var(--space-lg);
            left: 50%;
            transform: translateX(-50%);
            z-index: var(--z-tooltip);
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            pointer-events: none;
            max-width: calc(100% - var(--space-xl));
        }

        .toast {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-md) var(--space-lg);
            background: var(--color-text-primary);
            color: var(--color-white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            font-size: var(--text-body-sm);
            pointer-events: auto;
            animation: toast-slide-in 0.3s ease-out;
            max-width: 500px;
        }

        .toast.toast--hiding {
            animation: toast-slide-out 0.3s ease-in forwards;
        }

        @keyframes toast-slide-in {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes toast-slide-out {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(20px);
            }
        }

        .toast__icon {
            flex-shrink: 0;
            font-size: 20px;
        }

        .toast__message {
            flex: 1;
        }

        .toast__close {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            padding: 0;
            background: none;
            border: none;
            color: var(--color-white);
            opacity: 0.7;
            cursor: pointer;
            border-radius: var(--border-radius-sm);
            transition: opacity var(--transition-fast);
            flex-shrink: 0;
        }

        .toast__close:hover {
            opacity: 1;
        }

        /* Toast Variants */
        .toast--success {
            background: var(--color-success);
        }

        .toast--error {
            background: var(--color-error);
        }

        .toast--warning {
            background: var(--color-warning);
            color: var(--color-text-primary);
        }

        .toast--warning .toast__close {
            color: var(--color-text-primary);
        }

        .toast--info {
            background: var(--color-info);
        }

    </style>
</head>
<body>
    <!-- Top Bar with Language Selector (CD Bund) -->
    <div class="top-bar">
        <div class="top-bar__container">
            <div class="lang-dropdown" id="langDropdown">
                <button class="lang-dropdown__toggle" aria-expanded="false" aria-haspopup="true">
                    <span id="currentLang">DE</span>
                    <i data-lucide="chevron-down" aria-hidden="true"></i>
                </button>
                <div class="lang-dropdown__menu" role="menu">
                    <button class="lang-dropdown__item active" data-lang="de" role="menuitem">DE</button>
                    <button class="lang-dropdown__item" data-lang="fr" role="menuitem">FR</button>
                    <button class="lang-dropdown__item" data-lang="it" role="menuitem">IT</button>
                    <button class="lang-dropdown__item" data-lang="en" role="menuitem">EN</button>
                </div>
            </div>
        </div>
    </div>

    <header>
        <div class="header__top">
            <a href="#home" class="header__branding">
                <!-- Swiss Coat of Arms -->
                <div class="header__logo">
                    <img src="assets/swiss-logo-flag.svg" alt="Schweizerisches Wappen">
                </div>
                <!-- Multilingual Confederation Text -->
                <div class="header__confederation">
                    Schweizerische Eidgenossenschaft<br>
                    Confédération suisse<br>
                    Confederazione Svizzera<br>
                    Confederaziun svizra
                </div>
                <!-- Vertical Separator -->
                <div class="header__separator" aria-hidden="true"></div>
                <!-- Main Title -->
                <div class="header__title">
                    <span>KBOB</span>
                    <span>Fachdatenkatalog</span>
                </div>
            </a>
            <div class="header__controls">
                <div class="header__links">
                    <a href="https://www.kbob.admin.ch/de/kontakt-kbob" class="header__link" target="_blank">Kontakt</a>
                </div>
                <div class="header__search">
                    <button class="header__search-toggle" id="headerSearchToggle" aria-expanded="false" aria-controls="headerSearchForm">
                        <span>Suche</span>
                        <i data-lucide="search" aria-hidden="true"></i>
                    </button>
                    <form class="header__search-form" id="headerSearchForm" role="search" aria-label="Website durchsuchen">
                        <input type="search" id="headerSearchInput" class="header__search-input" placeholder="Suche" autocomplete="off">
                        <button type="button" class="header__search-clear" id="headerSearchClear" aria-label="Suche löschen">
                            <i data-lucide="x" aria-hidden="true"></i>
                        </button>
                        <button type="submit" class="header__search-submit" aria-label="Suchen">
                            <i data-lucide="search" aria-hidden="true"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
        <nav class="main-nav">
            <div class="container">
                <ul id="main-nav-list">
                    <li><a href="#home" class="nav-link active" data-route="home">Fachdatenkatalog</a></li>
                    <li><a href="#usecases" class="nav-link" data-route="usecases">Anwendungsfälle</a></li>
                    <li><a href="#elements" class="nav-link" data-route="elements">Elemente</a></li>
                    <li><a href="#models" class="nav-link" data-route="models">Fachmodelle</a></li>
                    <li><a href="#documents" class="nav-link" data-route="documents">Dokumente</a></li>
                    <li><a href="#epds" class="nav-link" data-route="epds">Ökobilanzdaten</a></li>
                    <li><a href="#handbook" class="nav-link" data-route="handbook">Handbuch & Downloads</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <div class="breadcrumb-bar" id="breadcrumb-bar">
        <div class="container breadcrumb-bar__inner">
            <nav class="breadcrumb-nav" id="breadcrumb-nav" aria-label="Breadcrumb">
                <a href="#home">Startseite</a>
            </nav>
            <div class="page-toolbar">
                <button class="toolbar-btn" onclick="window.print()" title="Drucken" aria-label="Seite drucken">
                    <i data-lucide="printer" aria-hidden="true"></i>
                </button>
                <button class="toolbar-btn" onclick="shareCurrentPage()" title="Teilen" aria-label="Seite teilen">
                    <i data-lucide="share-2" aria-hidden="true"></i>
                </button>
            </div>
        </div>
    </div>

    <main id="content-area">
         <div class="container loading-state">
            <i data-lucide="refresh-cw" class="loading-spinner" aria-hidden="true"></i><br>
            Anwendung wird initialisiert...
         </div>
    </main>

    <section class="contact-section">
        <div class="container">
            <div class="contact-details">
                <h3>Kontakt</h3>
                <address class="contact-info">
                    Fellerstrasse 21 | CH-3003 Bern | <a href="mailto:kbob@bbl.admin.ch">kbob@bbl.admin.ch</a>
                </address>
                <small class="contact-copyright">
                    © Koordinationskonferenz der Bau- und Liegenschaftsorgane der öffentlichen Bauherren KBOB
                </small>
            </div>
            <button class="scroll-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" title="Nach oben" aria-label="Nach oben scrollen">
                <i data-lucide="chevron-up" aria-hidden="true"></i>
            </button>
        </div>
    </section>

    <footer>
        <div class="footer-content">
           <a href="https://github.com/davras5/kbob-fdk" target="_blank">Quellcode</a>
           <a href="#" target="_blank">API</a>
           <a href="https://www.admin.ch/gov/de/start/rechtliches.html" target="_blank">Rechtliches</a>
           <span class="footer-version">Version 1.0.0 | Stand: Dezember 2024</span>
        </div>
    </footer>

    <script>
        const contentArea = document.getElementById('content-area');
        
        // --- STATE ---
        let globalElementsData = [];
        let globalDocumentsData = [];
        let globalUsecasesData = [];
        let globalModelsData = [];
        let globalEpdsData = [];
        let isDataLoaded = false;

        // Filter visibility states (collapsible filter panels)
        let elementsFilterVisible = false;
        let documentsFilterVisible = false;
        let usecasesFilterVisible = false;
        let modelsFilterVisible = false;
        let epdsFilterVisible = false;
        let currentSearchQuery = '';
        let currentSearchSort = 'date-desc';

        // Track which cards have expanded tags (show all tags)
        const expandedCardTags = new Set();

        // ============================================
        // BREADCRUMB FUNCTIONS
        // ============================================

        // Route name mappings for breadcrumbs
        const routeNames = {
            'home': 'Startseite',
            'elements': 'Elemente',
            'element': 'Element',
            'documents': 'Dokumente',
            'document': 'Dokument',
            'usecases': 'Anwendungsfälle',
            'usecase': 'Anwendungsfall',
            'models': 'Fachmodelle',
            'model': 'Fachmodell',
            'epds': 'Ökobilanzdaten',
            'epd': 'Ökobilanzdaten',
            'handbook': 'Handbuch & Downloads',
            'search': 'Suchergebnisse'
        };

        // Get parent route for detail pages
        const parentRoutes = {
            'element': 'elements',
            'document': 'documents',
            'usecase': 'usecases',
            'model': 'models',
            'epd': 'epds'
        };

        /**
         * Update breadcrumb navigation based on current route
         */
        function updateBreadcrumbs(route, id, itemTitle) {
            const breadcrumbNav = document.getElementById('breadcrumb-nav');
            if (!breadcrumbNav) return;

            let breadcrumbs = [];

            // Home is always first
            breadcrumbs.push({ label: 'Startseite', href: '#home' });

            if (route === 'home') {
                // Show Startseite > Fachdatenkatalog for home view
                breadcrumbs = [
                    { label: 'Startseite', href: '#home' },
                    { label: 'Fachdatenkatalog', href: null, current: true }
                ];
            } else if (parentRoutes[route]) {
                // Detail page - show parent category and current item
                const parentRoute = parentRoutes[route];
                breadcrumbs.push({
                    label: routeNames[parentRoute],
                    href: `#${parentRoute}`
                });
                breadcrumbs.push({
                    label: itemTitle || routeNames[route],
                    href: null,
                    current: true
                });
            } else {
                // List/category page
                breadcrumbs.push({
                    label: routeNames[route] || route,
                    href: null,
                    current: true
                });
            }

            // Build HTML with dropdown icons
            const html = breadcrumbs.map((crumb, index) => {
                const separator = index > 0
                    ? '<span class="breadcrumb-separator"><i data-lucide="chevron-right" aria-hidden="true"></i></span>'
                    : '';

                if (crumb.current) {
                    // Current item
                    return `${separator}<span class="breadcrumb-item"><span class="breadcrumb-current">${crumb.label}</span></span>`;
                } else {
                    // Link item
                    return `${separator}<span class="breadcrumb-item"><a href="${crumb.href}">${crumb.label}</a></span>`;
                }
            }).join('');

            breadcrumbNav.innerHTML = html;

            // Re-initialize lucide icons for the chevrons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        /**
         * Share current page using Web Share API or fallback to clipboard
         */
        function shareCurrentPage() {
            const url = window.location.href;
            const title = document.title;

            if (navigator.share) {
                navigator.share({
                    title: title,
                    url: url
                }).catch(() => {
                    // User cancelled or error
                    copyToClipboard(url);
                });
            } else {
                copyToClipboard(url);
            }
        }

        /**
         * Copy text to clipboard with toast notification
         */
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Link in Zwischenablage kopiert', 'success');
            }).catch(() => {
                showToast('Kopieren fehlgeschlagen', 'error');
            });
        }

        // ============================================
        // URL UTILITY FUNCTIONS
        // ============================================
        
        /**
         * Parse the current hash and extract route, id, and tags
         * @returns {Object} { route: string, id: string|null, tags: string[] }
         */
        function parseHashWithParams() {
            const fullHash = window.location.hash.slice(1) || 'home';
            const [hashPart, queryPart] = fullHash.split('?');
            
            // Parse route and id
            let route = hashPart;
            let id = null;
            
            if (hashPart.startsWith('element/')) {
                route = 'element';
                id = hashPart.split('/')[1];
            } else if (hashPart.startsWith('document/')) {
                route = 'document';
                id = hashPart.split('/')[1];
            } else if (hashPart.startsWith('usecase/')) {
                route = 'usecase';
                id = hashPart.split('/')[1];
            } else if (hashPart.startsWith('model/')) {
                route = 'model';
                id = hashPart.split('/')[1];
            } else if (hashPart.startsWith('epd/')) {
                route = 'epd';
                id = hashPart.split('/')[1];
            }
            
            // Parse query params
            const tags = [];
            const phases = [];
            let searchQuery = '';
            let category = '';
            let view = 'grid'; // Default view
            if (queryPart) {
                const params = new URLSearchParams(queryPart);
                params.getAll('tag').forEach(tag => {
                    if (tag) {
                        tags.push(tag);
                    }
                });
                params.getAll('phase').forEach(phase => {
                    const phaseNum = parseInt(phase, 10);
                    if (!isNaN(phaseNum) && phaseNum >= 1 && phaseNum <= 5) {
                        phases.push(phaseNum);
                    }
                });
                searchQuery = params.get('q') || '';
                category = params.get('category') || '';
                const viewParam = params.get('view');
                if (viewParam === 'list' || viewParam === 'grid') {
                    view = viewParam;
                }
            }

            return { route, id, tags, phases, searchQuery, category, view };
        }

        /**
         * Get active tags from the current URL
         * @returns {string[]} Array of tag strings like ['Architektur', 'IfcWindow']
         */
        function getActiveTagsFromURL() {
            return parseHashWithParams().tags;
        }

        /**
         * Get active category from the current URL
         * @returns {string} Category string or empty string
         */
        function getActiveCategoryFromURL() {
            return parseHashWithParams().category;
        }

        /**
         * Get active view from the current URL
         * @returns {string} View mode ('grid' or 'list'), defaults to 'grid'
         */
        function getActiveViewFromURL() {
            return parseHashWithParams().view;
        }

        /**
         * Build a hash string with tags, category, phases, and view
         * @param {string} baseHash - The base hash without params (e.g., 'catalog', 'element/e1')
         * @param {string[]} tags - Array of tag strings
         * @param {string} category - Optional category string
         * @param {number[]} phases - Optional array of phase numbers (for usecases)
         * @param {string} view - Optional view mode ('grid' or 'list')
         * @returns {string} Complete hash string with params
         */
        function buildHashWithTags(baseHash, tags, category = '', phases = [], view = '') {
            const params = [];
            if (tags && tags.length > 0) {
                tags.forEach(tag => params.push(`tag=${encodeURIComponent(tag)}`));
            }
            if (category) {
                params.push(`category=${encodeURIComponent(category)}`);
            }
            if (phases && phases.length > 0) {
                phases.forEach(phase => params.push(`phase=${phase}`));
            }
            if (view && (view === 'grid' || view === 'list')) {
                params.push(`view=${view}`);
            }
            if (params.length === 0) {
                return baseHash;
            }
            return `${baseHash}?${params.join('&')}`;
        }
        
        /**
         * Toggle a tag in the URL (add if missing, remove if present)
         * @param {string} tag - Tag string (e.g., 'Architektur')
         */
        window.toggleTagInURL = function(tag) {
            const { route, id, tags, category, phases, view } = parseHashWithParams();

            const tagIndex = tags.indexOf(tag);
            if (tagIndex > -1) {
                // Remove tag
                tags.splice(tagIndex, 1);
            } else {
                // Add tag
                tags.push(tag);
            }

            // Build base hash - redirect to list view if on detail page
            let baseHash = route;
            if (id) {
                // On detail page: redirect to corresponding list view
                const routeMap = {
                    'element': 'elements',
                    'document': 'documents',
                    'usecase': 'usecases',
                    'model': 'models',
                    'epd': 'epds'
                };
                baseHash = routeMap[route] || route;
            }

            // Navigate to new URL (preserve category, phases, and view)
            window.location.hash = buildHashWithTags(baseHash, tags, category, phases, view);
        }

        /**
         * Toggle a category in the URL (add if not set, remove if same category)
         * @param {string} cat - Category string (e.g., 'Grundlagen')
         */
        window.toggleCategoryInURL = function(cat) {
            const { route, id, tags, category, phases, view } = parseHashWithParams();

            // Toggle: if same category, remove it; otherwise set the new one
            const newCategory = (category === cat) ? '' : cat;

            // Build base hash - redirect to list view if on detail page
            let baseHash = route;
            if (id) {
                // On detail page: redirect to corresponding list view
                const routeMap = {
                    'element': 'elements',
                    'document': 'documents',
                    'usecase': 'usecases',
                    'model': 'models',
                    'epd': 'epds'
                };
                baseHash = routeMap[route] || route;
            }

            // Navigate to new URL (preserve tags, phases, and view)
            window.location.hash = buildHashWithTags(baseHash, tags, newCategory, phases, view);
        }

        /**
         * Toggle a phase in the URL (add if missing, remove if present)
         * @param {number} phase - Phase number (1-5)
         */
        window.togglePhaseInURL = function(phase) {
            const { route, id, tags, category, phases, view } = parseHashWithParams();
            const phaseNum = parseInt(phase, 10);

            const phaseIndex = phases.indexOf(phaseNum);
            if (phaseIndex > -1) {
                // Remove phase
                phases.splice(phaseIndex, 1);
            } else {
                // Add phase
                phases.push(phaseNum);
            }

            // Build base hash - redirect to list view if on detail page
            let baseHash = route;
            if (id) {
                const routeMap = {
                    'element': 'elements',
                    'document': 'documents',
                    'usecase': 'usecases',
                    'model': 'models',
                    'epd': 'epds'
                };
                baseHash = routeMap[route] || route;
            }

            // Navigate to new URL (preserve view)
            window.location.hash = buildHashWithTags(baseHash, tags, category, phases, view);
        }

        /**
         * Clear all tags from URL
         */
        window.clearAllTagsFromURL = function() {
            const { route, id } = parseHashWithParams();
            let baseHash = route;
            if (id) {
                baseHash = `${route}/${id}`;
            }
            window.location.hash = baseHash;
        }

        /**
         * Clear all filters (wrapper for toolbar reset button)
         */
        window.clearAllFilters = function(type) {
            clearAllTagsFromURL();
        }

        /**
         * Navigate to a route while preserving current tags, category, phases, and view
         * @param {string} targetRoute - Target route (e.g., 'catalog', 'documents')
         */
        function navigateWithTags(targetRoute) {
            const tags = getActiveTagsFromURL();
            const category = getActiveCategoryFromURL();
            const phases = getActivePhasesFromURL();
            const view = getActiveViewFromURL();
            window.location.hash = buildHashWithTags(targetRoute, tags, category, phases, view);
        }

        /**
         * Filter data by active tags (AND logic - must match all tags)
         * @param {Array} data - Array of data items
         * @param {string[]} activeTags - Array of tag strings
         * @returns {Array} Filtered data
         */
        function filterDataByTags(data, activeTags) {
            if (!activeTags || activeTags.length === 0) {
                return data;
            }

            return data.filter(item => {
                if (!item.tags || !Array.isArray(item.tags)) return false;

                return activeTags.every(tag => item.tags.includes(tag));
            });
        }

        /**
         * Filter data by active category
         * @param {Array} data - Array of data items
         * @param {string} activeCategory - Category string
         * @returns {Array} Filtered data
         */
        function filterDataByCategory(data, activeCategory) {
            if (!activeCategory) {
                return data;
            }

            return data.filter(item => item.category === activeCategory);
        }

        /**
         * Check if a specific tag is active
         * @param {string} tag - Tag string
         * @returns {boolean}
         */
        function isTagActive(tag) {
            const activeTags = getActiveTagsFromURL();
            return activeTags.includes(tag);
        }

        // --- FILTER DATA EXTRACTION HELPERS ---

        /**
         * Extract unique categories from data array
         * @param {Array} data - Array of data items
         * @returns {string[]} Sorted array of unique categories
         */
        function getUniqueCategories(data) {
            if (!data || !Array.isArray(data)) return [];
            const categories = new Set();
            data.forEach(item => {
                if (item.category) {
                    categories.add(item.category);
                }
            });
            return Array.from(categories).sort();
        }

        /**
         * Extract unique tags from data array
         * @param {Array} data - Array of data items
         * @returns {string[]} Sorted array of unique tags
         */
        function getUniqueTags(data) {
            if (!data || !Array.isArray(data)) return [];
            const tags = new Set();
            data.forEach(item => {
                if (item.tags && Array.isArray(item.tags)) {
                    item.tags.forEach(tag => tags.add(tag));
                }
            });
            return Array.from(tags).sort();
        }

        /**
         * Get phase labels for display
         */
        const phaseLabels = {
            1: 'Entwicklung',
            2: 'Planung',
            3: 'Ausführung',
            4: 'Betrieb',
            5: 'Rückbau'
        };

        /**
         * Filter data by active phases (OR logic - item must include at least one selected phase)
         * @param {Array} data - Array of data items
         * @param {number[]} activePhases - Array of phase numbers
         * @returns {Array} Filtered data
         */
        function filterDataByPhases(data, activePhases) {
            if (!activePhases || activePhases.length === 0) {
                return data;
            }
            return data.filter(item => {
                if (!item.phases || !Array.isArray(item.phases)) return false;
                return activePhases.some(phase => item.phases.includes(phase));
            });
        }

        /**
         * Get active phases from the current URL
         * @returns {number[]} Array of phase numbers
         */
        function getActivePhasesFromURL() {
            return parseHashWithParams().phases || [];
        }

        // --- INITIALIZATION ---
        async function initApp() {
            try {
                // Load all data
                const [elementsResponse, documentsResponse, usecasesResponse, modelsResponse, epdsResponse] = await Promise.all([
                    fetch('data/elements.json'),
                    fetch('data/documents.json'),
                    fetch('data/usecases.json'),
                    fetch('data/models.json'),
                    fetch('data/epds.json')
                ]);

                if (!elementsResponse.ok) throw new Error(`Elements: HTTP error! status: ${elementsResponse.status}`);
                if (!documentsResponse.ok) throw new Error(`Documents: HTTP error! status: ${documentsResponse.status}`);
                if (!usecasesResponse.ok) throw new Error(`Usecases: HTTP error! status: ${usecasesResponse.status}`);
                if (!modelsResponse.ok) throw new Error(`Models: HTTP error! status: ${modelsResponse.status}`);
                if (!epdsResponse.ok) throw new Error(`EPDs: HTTP error! status: ${epdsResponse.status}`);

                globalElementsData = await elementsResponse.json();
                globalDocumentsData = await documentsResponse.json();
                globalUsecasesData = await usecasesResponse.json();
                globalModelsData = await modelsResponse.json();
                globalEpdsData = await epdsResponse.json();

                isDataLoaded = true;

                // Setup nav link click handlers for tag preservation
                setupNavLinks();

                // Setup header search toggle and form
                setupHeaderSearch();

                window.addEventListener('hashchange', router);
                router();
            } catch (error) {
                console.error("Fehler beim Laden der Daten:", error);
                contentArea.innerHTML = `
                    <div class="container error-state">
                        <i data-lucide="alert-circle" class="status-icon status-icon--error icon--3xl" aria-hidden="true"></i><br>
                        <h2>Fehler beim Laden der Daten</h2>
                        <p>Konnte JSON-Dateien nicht laden.</p>
                        <br><span class="error-detail">${error.message}</span>
                    </div>`;
                lucide.createIcons();
            }
        }
        
        /**
         * Setup nav links to preserve tags when switching tabs
         */
        function setupNavLinks() {
            document.querySelectorAll('.main-nav .nav-link:not(.disabled)').forEach(link => {
                link.addEventListener('click', (e) => {
                    const route = link.getAttribute('data-route');
                    if (route) {
                        e.preventDefault();
                        navigateWithTags(route);
                    }
                });
            });
        }

        // --- ROUTER ---
        function router() {
            if (!isDataLoaded) return;

            const { route, id, tags, searchQuery, category } = parseHashWithParams();

            // Update nav active states
            document.querySelectorAll('.main-nav .nav-link:not(.disabled)').forEach(link => {
                const linkRoute = link.getAttribute('data-route');
                let isActive = false;
                if (route === 'element') {
                    isActive = (linkRoute === 'elements');
                } else if (route === 'document') {
                    isActive = (linkRoute === 'documents');
                } else if (route === 'usecase') {
                    isActive = (linkRoute === 'usecases');
                } else if (route === 'model') {
                    isActive = (linkRoute === 'models');
                } else if (route === 'epd') {
                    isActive = (linkRoute === 'epds');
                } else {
                    isActive = (linkRoute === route);
                }
                link.classList.toggle('active', isActive);
            });

            // Update breadcrumbs
            let itemTitle = null;
            if (id) {
                // Get item title for detail pages
                if (route === 'element') {
                    const item = globalElementsData.find(e => e.id === id);
                    itemTitle = item ? item.title : null;
                } else if (route === 'document') {
                    const item = globalDocumentsData.find(d => d.id === id);
                    itemTitle = item ? item.title : null;
                } else if (route === 'usecase') {
                    const item = globalUsecasesData.find(u => u.id === id);
                    itemTitle = item ? item.title : null;
                } else if (route === 'model') {
                    const item = globalModelsData.find(m => m.id === id);
                    itemTitle = item ? item.title : null;
                } else if (route === 'epd') {
                    const item = globalEpdsData.find(e => e.id === id);
                    itemTitle = item ? item.title : null;
                }
            }
            updateBreadcrumbs(route, id, itemTitle);

            contentArea.classList.remove('white-bg');

            switch(route) {
                case 'home': renderHomePage(); break;
                case 'search': renderSearchResultsPage(searchQuery); break;
                case 'elements': renderCatalogPage(tags, category); break;
                case 'documents': renderDocumentsCatalogPage(tags, category); break;
                case 'usecases': renderUsecasesCatalogPage(tags, category); break;
                case 'models': renderModelsCatalogPage(tags, category); break;
                case 'epds': renderEpdsCatalogPage(tags, category); break;
                case 'handbook': renderHandbookPage(); break;
                case 'element':
                    if(id) {
                        contentArea.classList.add('white-bg');
                        renderElementDetailPage(id, tags);
                    } else {
                        navigateWithTags('elements');
                    }
                    break;
                case 'document':
                    if(id) {
                        contentArea.classList.add('white-bg');
                        renderDocumentDetailPage(id, tags, category);
                    } else {
                        navigateWithTags('documents');
                    }
                    break;
                case 'usecase':
                    if(id) {
                        contentArea.classList.add('white-bg');
                        renderUsecaseDetailPage(id, tags, category);
                    } else {
                        navigateWithTags('usecases');
                    }
                    break;
                case 'model':
                    if(id) {
                        contentArea.classList.add('white-bg');
                        renderModelDetailPage(id, tags, category);
                    } else {
                        navigateWithTags('models');
                    }
                    break;
                case 'epd':
                    if(id) {
                        contentArea.classList.add('white-bg');
                        renderEpdDetailPage(id, tags, category);
                    } else {
                        navigateWithTags('epds');
                    }
                    break;
                default: navigateWithTags('home');
            }

            // Initialize Lucide icons after rendering
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        // --- VIEW CONTROLS ---
        window.switchView = function(view) {
            // Update URL with new view parameter - this triggers the router to re-render
            const { route, tags, category, phases } = parseHashWithParams();
            window.location.hash = buildHashWithTags(route, tags, category, phases, view);
        }

        window.toggleFilter = function(type = 'elements') {
            if (type === 'elements') {
                elementsFilterVisible = !elementsFilterVisible;
                renderCatalogPage(getActiveTagsFromURL(), getActiveCategoryFromURL());
            } else if (type === 'documents') {
                documentsFilterVisible = !documentsFilterVisible;
                renderDocumentsCatalogPage(getActiveTagsFromURL(), getActiveCategoryFromURL());
            } else if (type === 'usecases') {
                usecasesFilterVisible = !usecasesFilterVisible;
                renderUsecasesCatalogPage(getActiveTagsFromURL(), getActiveCategoryFromURL());
            } else if (type === 'models') {
                modelsFilterVisible = !modelsFilterVisible;
                renderModelsCatalogPage(getActiveTagsFromURL(), getActiveCategoryFromURL());
            } else if (type === 'epds') {
                epdsFilterVisible = !epdsFilterVisible;
                renderEpdsCatalogPage(getActiveTagsFromURL(), getActiveCategoryFromURL());
            }
        }

        // --- RENDER HELPERS ---
        function renderTagsHtml(tagsData, activeTags = []) {
            if (!tagsData || !Array.isArray(tagsData)) return '';
            return tagsData.map(tag => {
                const isActive = activeTags.includes(tag);
                const activeClass = isActive ? 'active' : '';
                return `<span class="tag-badge ${activeClass}" onclick="event.stopPropagation(); toggleTagInURL('${tag}')" title="Filter: ${tag}">${tag}</span>`;
            }).join('');
        }

        /**
         * Toggle card tags expanded state and re-render the tags container
         */
        window.toggleCardTags = function(cardId) {
            event.stopPropagation();
            if (expandedCardTags.has(cardId)) {
                expandedCardTags.delete(cardId);
            } else {
                expandedCardTags.add(cardId);
            }
            // Re-render just the tags container for this card
            const tagsContainer = document.querySelector(`[data-card-id="${cardId}"] .card__tags`);
            if (tagsContainer) {
                const tagsData = JSON.parse(tagsContainer.dataset.tags || '[]');
                const activeTags = getActiveTagsFromURL();
                tagsContainer.innerHTML = renderCardTagsHtml(cardId, tagsData, activeTags);
            }
        };

        /**
         * Render tags for card with +N / - toggle (max 2 visible by default)
         */
        function renderCardTagsHtml(cardId, tagsData, activeTags = []) {
            if (!tagsData || !Array.isArray(tagsData) || tagsData.length === 0) return '';

            const maxVisible = 2;
            const isExpanded = expandedCardTags.has(cardId);
            const hiddenCount = tagsData.length - maxVisible;

            // If 2 or fewer tags, or expanded, show all tags
            if (tagsData.length <= maxVisible || isExpanded) {
                const tagsHtml = tagsData.map(tag => {
                    const isActive = activeTags.includes(tag);
                    const activeClass = isActive ? 'active' : '';
                    return `<span class="tag-badge ${activeClass}" onclick="event.stopPropagation(); toggleTagInURL('${tag}')" title="Filter: ${tag}">${tag}</span>`;
                }).join('');

                // Add collapse button if expanded and has more than maxVisible
                if (isExpanded && tagsData.length > maxVisible) {
                    return tagsHtml + `<span class="tag-badge tag-badge--count" onclick="toggleCardTags('${cardId}')" title="Weniger anzeigen">−</span>`;
                }
                return tagsHtml;
            }

            // Show limited tags with +N button
            const visibleTags = tagsData.slice(0, maxVisible);
            const tagsHtml = visibleTags.map(tag => {
                const isActive = activeTags.includes(tag);
                const activeClass = isActive ? 'active' : '';
                return `<span class="tag-badge ${activeClass}" onclick="event.stopPropagation(); toggleTagInURL('${tag}')" title="Filter: ${tag}">${tag}</span>`;
            }).join('');

            return tagsHtml + `<span class="tag-badge tag-badge--count" onclick="toggleCardTags('${cardId}')" title="${hiddenCount} weitere Tags anzeigen">+${hiddenCount}</span>`;
        }
        
        /**
         * Render filter bar header with optional reset icon
         */
        function renderFilterBarHeader(activeTags, activeCategory = '') {
            const hasFilters = activeTags.length > 0 || activeCategory;
            const resetBtn = hasFilters
                ? `<button class="filter-bar__reset" onclick="clearAllFilters()" title="Filter zurücksetzen" aria-label="Filter zurücksetzen"><i data-lucide="x" aria-hidden="true"></i></button>`
                : '';

            // Build active filters display
            let activeFiltersHtml = '';
            if (hasFilters) {
                const filterBadges = [];
                if (activeCategory) {
                    filterBadges.push(`<span class="tag-badge active" onclick="toggleCategoryInURL('${activeCategory}')">${activeCategory} <i data-lucide="x" style="width:12px;height:12px;vertical-align:middle;margin-left:4px;"></i></span>`);
                }
                activeTags.forEach(tag => {
                    filterBadges.push(`<span class="tag-badge active" onclick="toggleTagInURL('${tag}')">${tag} <i data-lucide="x" style="width:12px;height:12px;vertical-align:middle;margin-left:4px;"></i></span>`);
                });
                activeFiltersHtml = `<div class="filter-bar__active-filters" style="display:flex;gap:var(--space-sm);flex-wrap:wrap;margin-top:var(--space-sm);">${filterBadges.join('')}</div>`;
            }

            return `<div class="filter-bar__header"><span>Filter</span>${resetBtn}</div>${activeFiltersHtml}`;
        }

        /**
         * Toggle filter dropdown open/closed
         * @param {string} groupId - The filter group identifier
         */
        window.toggleFilterDropdown = function(groupId) {
            event.stopPropagation();
            const allGroups = document.querySelectorAll('.filter-group');
            allGroups.forEach(group => {
                if (group.dataset.filterId === groupId) {
                    group.classList.toggle('open');
                } else {
                    group.classList.remove('open');
                }
            });
        }

        /**
         * Close all filter dropdowns when clicking outside
         */
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.filter-group')) {
                document.querySelectorAll('.filter-group.open').forEach(group => {
                    group.classList.remove('open');
                });
            }
        });

        /**
         * Render complete filter bar with category and tags dropdowns
         * @param {Object} options - Configuration options
         * @param {Array} options.data - The data array to extract filters from
         * @param {string[]} options.activeTags - Currently active tags
         * @param {string} options.activeCategory - Currently active category
         * @param {number[]} options.activePhases - Currently active phases (for usecases)
         * @param {boolean} options.showPhases - Whether to show phases filter
         * @param {string} options.filterPanelClass - CSS class for visibility
         * @returns {string} HTML string for the filter bar
         */
        function renderFilterBar(options) {
            const {
                data = [],
                activeTags = [],
                activeCategory = '',
                activePhases = [],
                showPhases = false,
                filterPanelClass = ''
            } = options;

            // Extract unique categories and tags from data
            const categories = getUniqueCategories(data);
            const tags = getUniqueTags(data);

            // Count items per category
            const categoryCounts = {};
            categories.forEach(cat => {
                categoryCounts[cat] = data.filter(item => item.category === cat).length;
            });

            // Count items per tag
            const tagCounts = {};
            tags.forEach(tag => {
                tagCounts[tag] = data.filter(item => item.tags && item.tags.includes(tag)).length;
            });

            // Render category dropdown items
            const categoryItemsHtml = categories.map(cat => {
                const isActive = activeCategory === cat;
                const count = categoryCounts[cat];
                return `<span class="filter-dropdown__item ${isActive ? 'active' : ''}" onclick="event.stopPropagation(); toggleCategoryInURL('${cat}')">${cat} <span class="filter-dropdown__count">${count}</span></span>`;
            }).join('');

            // Render tag dropdown items
            const tagItemsHtml = tags.map(tag => {
                const isActive = activeTags.includes(tag);
                const count = tagCounts[tag];
                return `<span class="filter-dropdown__item ${isActive ? 'active' : ''}" onclick="event.stopPropagation(); toggleTagInURL('${tag}')">${tag} <span class="filter-dropdown__count">${count}</span></span>`;
            }).join('');

            // Render phases dropdown if needed
            let phasesGroupHtml = '';
            if (showPhases) {
                const phasesItemsHtml = [1, 2, 3, 4, 5].map(phase => {
                    const isActive = activePhases.includes(phase);
                    const label = phaseLabels[phase];
                    return `
                        <div class="filter-dropdown__phase-item ${isActive ? 'active' : ''}" onclick="event.stopPropagation(); togglePhaseInURL(${phase})">
                            <span class="filter-dropdown__phase-number">${phase}</span>
                            <span class="filter-dropdown__phase-label">${label}</span>
                        </div>
                    `;
                }).join('');

                const activePhasesCount = activePhases.length;
                phasesGroupHtml = `
                    <div class="filter-group" data-filter-id="phases">
                        <div class="filter-toggle" onclick="toggleFilterDropdown('phases')">
                            Phase ${activePhasesCount > 0 ? `<span class="filter-count-badge" style="background:var(--color-primary);color:white;padding:2px 6px;border-radius:10px;font-size:11px;margin-left:4px;">${activePhasesCount}</span>` : ''}
                            <i data-lucide="chevron-down" aria-hidden="true"></i>
                        </div>
                        <div class="filter-dropdown">
                            <div class="filter-dropdown__title">SIA-Phasen</div>
                            <div class="filter-dropdown__phases">
                                ${phasesItemsHtml}
                            </div>
                        </div>
                    </div>
                `;
            }

            // Calculate total active filter count
            const hasFilters = activeTags.length > 0 || activeCategory || activePhases.length > 0;
            const resetBtn = hasFilters
                ? `<button class="filter-bar__reset" onclick="clearAllFilters()" title="Filter zurücksetzen" aria-label="Filter zurücksetzen"><i data-lucide="x" aria-hidden="true"></i></button>`
                : '';

            // Build active filters display
            let activeFiltersHtml = '';
            if (hasFilters) {
                const filterBadges = [];
                if (activeCategory) {
                    filterBadges.push(`<span class="tag-badge active" onclick="toggleCategoryInURL('${activeCategory}')">${activeCategory} <i data-lucide="x" style="width:12px;height:12px;vertical-align:middle;margin-left:4px;"></i></span>`);
                }
                activeTags.forEach(tag => {
                    filterBadges.push(`<span class="tag-badge active" onclick="toggleTagInURL('${tag}')">${tag} <i data-lucide="x" style="width:12px;height:12px;vertical-align:middle;margin-left:4px;"></i></span>`);
                });
                activePhases.forEach(phase => {
                    filterBadges.push(`<span class="tag-badge active" onclick="togglePhaseInURL(${phase})">Phase ${phase} <i data-lucide="x" style="width:12px;height:12px;vertical-align:middle;margin-left:4px;"></i></span>`);
                });
                activeFiltersHtml = `<div class="filter-bar__active-filters" style="display:flex;gap:var(--space-sm);flex-wrap:wrap;padding:var(--space-sm) var(--space-lg);border-top:1px solid var(--color-border-light);">${filterBadges.join('')}</div>`;
            }

            // Count badges for category and tags
            const activeCategoryCount = activeCategory ? 1 : 0;
            const activeTagsCount = activeTags.length;

            return `
                <div class="filter-bar ${filterPanelClass}">
                    <div class="filter-bar__header"><span>Filter</span>${resetBtn}</div>
                    <div class="filter-bar__groups">
                        <div class="filter-group" data-filter-id="category">
                            <div class="filter-toggle" onclick="toggleFilterDropdown('category')">
                                Kategorie ${activeCategoryCount > 0 ? `<span class="filter-count-badge" style="background:var(--color-primary);color:white;padding:2px 6px;border-radius:10px;font-size:11px;margin-left:4px;">${activeCategoryCount}</span>` : ''}
                                <i data-lucide="chevron-down" aria-hidden="true"></i>
                            </div>
                            <div class="filter-dropdown">
                                <div class="filter-dropdown__title">Kategorie wählen</div>
                                <div class="filter-dropdown__items">
                                    ${categoryItemsHtml}
                                </div>
                            </div>
                        </div>
                        <div class="filter-group" data-filter-id="tags">
                            <div class="filter-toggle" onclick="toggleFilterDropdown('tags')">
                                Tags ${activeTagsCount > 0 ? `<span class="filter-count-badge" style="background:var(--color-primary);color:white;padding:2px 6px;border-radius:10px;font-size:11px;margin-left:4px;">${activeTagsCount}</span>` : ''}
                                <i data-lucide="chevron-down" aria-hidden="true"></i>
                            </div>
                            <div class="filter-dropdown">
                                <div class="filter-dropdown__title">Tags wählen</div>
                                <div class="filter-dropdown__items">
                                    ${tagItemsHtml}
                                </div>
                            </div>
                        </div>
                        ${phasesGroupHtml}
                    </div>
                    ${activeFiltersHtml}
                </div>
            `;
        }

        /**
         * Render filter button with reset button (visible when filters active)
         */
        function renderFilterButton(type, isVisible, activeTagCount) {
            const activeClass = isVisible ? 'active' : '';

            const resetBtn = activeTagCount > 0
                ? `<button class="reset-filter-btn" onclick="clearAllFilters('${type}')" title="Filter zurücksetzen"><i data-lucide="refresh-cw" aria-hidden="true"></i> Zurücksetzen</button>`
                : '';

            return `
                <button class="filter-btn ${activeClass}" onclick="toggleFilter('${type}')">
                    <i data-lucide="filter" aria-hidden="true"></i>
                    Filter${activeTagCount > 0 ? `<span class="filter-count-badge">${activeTagCount}</span>` : ''}
                </button>
                ${resetBtn}
            `;
        }
        
        /**
         * Render no results message with clear filter option
         */
        function renderNoResults(hasActiveTags) {
            if (hasActiveTags) {
                return `
                    <div class="no-results">
                        <h3>Keine Ergebnisse gefunden</h3>
                        <p>Die aktiven Filter ergeben keine Treffer.</p>
                        <p><span class="clear-filter-link" onclick="clearAllTagsFromURL()">Filter zurücksetzen</span></p>
                    </div>
                `;
            }
            return '<div class="no-results">Keine Elemente gefunden.</div>';
        }

        // Arrow SVG for Swiss CD style cards
        const arrowSvg = `<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M5 12h14M12 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"/></svg>`;

        // Elements Grid/List Renderers
        function renderGridItemsHTML(items, activeTags = [], activeCategory = '') {
            if (!items || items.length === 0) return renderNoResults(activeTags.length > 0 || activeCategory);

            return items.map(el => {
                const hasTags = el.tags && Array.isArray(el.tags) && el.tags.length > 0;
                const cardId = `element-${el.id}`;
                const isCategoryActive = activeCategory === el.category;

                return `
                <article class="card" data-card-id="${cardId}" onclick="window.location.hash='${buildHashWithTags('element/' + el.id, activeTags, activeCategory)}'">
                    <div class="card__image">
                        ${el.category ? `<span class="tag-badge ${isCategoryActive ? 'active' : ''}" onclick="event.stopPropagation(); toggleCategoryInURL('${el.category}')">${el.category}</span>` : ''}
                        ${el.image ? `<img src="${el.image}" alt="${el.title}">` : '<i data-lucide="image" class="placeholder-icon icon--xl" aria-hidden="true"></i>'}
                    </div>
                    <div class="card__body">
                        <h3 class="card__title">${el.title}</h3>
                        <p class="card__subtitle">${el.description || el.classification}</p>
                        ${hasTags ? `<div class="card__tags" data-tags='${JSON.stringify(el.tags)}'>${renderCardTagsHtml(cardId, el.tags, activeTags)}</div>` : ''}
                    </div>
                    <footer class="card__footer card__footer--end">
                        <span class="card__arrow-btn" aria-label="Details anzeigen">${arrowSvg}</span>
                    </footer>
                </article>
            `}).join('');
        }

        function renderListItemsHTML(items, activeTags = [], activeCategory = '') {
            if (!items || items.length === 0) return renderNoResults(activeTags.length > 0 || activeCategory);

            const headerHtml = `
                <div class="list-header-row">
                    <div class="list-col-name">Name</div>
                    <div class="list-col-desc">Beschreibung</div>
                    <div class="list-col-tags">Tags</div>
                </div>
            `;

            const itemsHtml = items.map(el => {
                const isCategoryActive = activeCategory === el.category;
                return `
                <div class="element-list-item" onclick="window.location.hash='${buildHashWithTags('element/' + el.id, activeTags, activeCategory)}'">
                    <div class="list-col-name">
                        ${el.category ? `<span class="tag-badge ${isCategoryActive ? 'active' : ''}" style="margin-right:var(--space-sm);" onclick="event.stopPropagation(); toggleCategoryInURL('${el.category}')">${el.category}</span>` : ''}
                        ${el.title}
                    </div>
                    <div class="list-col-desc">${el.description || el.classification}</div>
                    <div class="list-col-tags">${renderTagsHtml(el.tags, activeTags)}</div>
                </div>
            `}).join('');

            return `<div class="element-list-container">${headerHtml}${itemsHtml}</div>`;
        }

        // Documents Grid/List Renderers
        function renderDocGridItemsHTML(items, activeTags = [], activeCategory = '') {
            if (!items || items.length === 0) return renderNoResults(activeTags.length > 0 || activeCategory);

            return items.map(doc => {
                const hasTags = doc.tags && Array.isArray(doc.tags) && doc.tags.length > 0;
                const cardId = `document-${doc.id}`;
                const isCategoryActive = activeCategory === doc.category;

                return `
                <article class="card" data-card-id="${cardId}" onclick="window.location.hash='${buildHashWithTags('document/' + doc.id, activeTags, activeCategory)}'">
                    <div class="card__image">
                        ${doc.category ? `<span class="tag-badge ${isCategoryActive ? 'active' : ''}" onclick="event.stopPropagation(); toggleCategoryInURL('${doc.category}')">${doc.category}</span>` : ''}
                        ${doc.image ? `<img src="${doc.image}" alt="${doc.title}">` : '<i data-lucide="file-text" class="placeholder-icon icon--xl" aria-hidden="true"></i>'}
                    </div>
                    <div class="card__body">
                        <h3 class="card__title">${doc.title}</h3>
                        <p class="card__subtitle">${doc.description || doc.category}</p>
                        ${hasTags ? `<div class="card__tags" data-tags='${JSON.stringify(doc.tags)}'>${renderCardTagsHtml(cardId, doc.tags, activeTags)}</div>` : ''}
                    </div>
                    <footer class="card__footer card__footer--end">
                        <span class="card__arrow-btn" aria-label="Details anzeigen">${arrowSvg}</span>
                    </footer>
                </article>
            `}).join('');
        }

        function renderDocListItemsHTML(items, activeTags = [], activeCategory = '') {
            if (!items || items.length === 0) return renderNoResults(activeTags.length > 0 || activeCategory);

            const headerHtml = `
                <div class="list-header-row">
                    <div class="list-col-name">Name</div>
                    <div class="list-col-desc">Beschreibung</div>
                    <div class="list-col-tags">Tags</div>
                </div>
            `;

            const itemsHtml = items.map(doc => {
                const isCategoryActive = activeCategory === doc.category;
                return `
                <div class="element-list-item" onclick="window.location.hash='${buildHashWithTags('document/' + doc.id, activeTags, activeCategory)}'">
                    <div class="list-col-name">
                        ${doc.category ? `<span class="tag-badge ${isCategoryActive ? 'active' : ''}" style="margin-right:var(--space-sm);" onclick="event.stopPropagation(); toggleCategoryInURL('${doc.category}')">${doc.category}</span>` : ''}
                        ${doc.title}
                    </div>
                    <div class="list-col-desc">${doc.description || doc.category}</div>
                    <div class="list-col-tags">${renderTagsHtml(doc.tags, activeTags)}</div>
                </div>
            `}).join('');

            return `<div class="element-list-container">${headerHtml}${itemsHtml}</div>`;
        }

        // Usecases Grid/List Renderers
        function renderUsecasesGridItemsHTML(items, activeTags = [], activeCategory = '') {
            if (!items || items.length === 0) return renderNoResults(activeTags.length > 0 || activeCategory);

            return items.map(item => {
                const hasTags = item.tags && Array.isArray(item.tags) && item.tags.length > 0;
                const cardId = `usecase-${item.id}`;
                const isCategoryActive = activeCategory === item.category;

                return `
                <article class="card" data-card-id="${cardId}" onclick="window.location.hash='${buildHashWithTags('usecase/' + item.id, activeTags, activeCategory)}'">
                    <div class="card__image">
                        ${item.category ? `<span class="tag-badge ${isCategoryActive ? 'active' : ''}" onclick="event.stopPropagation(); toggleCategoryInURL('${item.category}')">${item.category}</span>` : ''}
                        ${item.image ? `<img src="${item.image}" alt="${item.title}">` : '<i data-lucide="workflow" class="placeholder-icon icon--xl" aria-hidden="true"></i>'}
                    </div>
                    <div class="card__body">
                        <h3 class="card__title">${item.title}</h3>
                        <p class="card__subtitle">${item.description || item.category}</p>
                        ${hasTags ? `<div class="card__tags" data-tags='${JSON.stringify(item.tags)}'>${renderCardTagsHtml(cardId, item.tags, activeTags)}</div>` : ''}
                    </div>
                    <footer class="card__footer card__footer--end">
                        <span class="card__arrow-btn" aria-label="Details anzeigen">${arrowSvg}</span>
                    </footer>
                </article>
            `}).join('');
        }

        function renderUsecasesListItemsHTML(items, activeTags = [], activeCategory = '') {
            if (!items || items.length === 0) return renderNoResults(activeTags.length > 0 || activeCategory);

            const headerHtml = `
                <div class="list-header-row">
                    <div class="list-col-name">Name</div>
                    <div class="list-col-desc">Beschreibung</div>
                    <div class="list-col-tags">Tags</div>
                </div>
            `;

            const itemsHtml = items.map(item => {
                const isCategoryActive = activeCategory === item.category;
                return `
                <div class="element-list-item" onclick="window.location.hash='${buildHashWithTags('usecase/' + item.id, activeTags, activeCategory)}'">
                    <div class="list-col-name">
                        ${item.category ? `<span class="tag-badge ${isCategoryActive ? 'active' : ''}" style="margin-right:var(--space-sm);" onclick="event.stopPropagation(); toggleCategoryInURL('${item.category}')">${item.category}</span>` : ''}
                        ${item.title}
                    </div>
                    <div class="list-col-desc">${item.description || item.category}</div>
                    <div class="list-col-tags">${renderTagsHtml(item.tags, activeTags)}</div>
                </div>
            `}).join('');

            return `<div class="element-list-container">${headerHtml}${itemsHtml}</div>`;
        }

        // Models Grid/List Renderers
        function renderModelsGridItemsHTML(items, activeTags = [], activeCategory = '') {
            if (!items || items.length === 0) return renderNoResults(activeTags.length > 0 || activeCategory);

            return items.map(item => {
                const hasTags = item.tags && Array.isArray(item.tags) && item.tags.length > 0;
                const cardId = `model-${item.id}`;
                const isCategoryActive = activeCategory === item.category;

                return `
                <article class="card" data-card-id="${cardId}" onclick="window.location.hash='${buildHashWithTags('model/' + item.id, activeTags, activeCategory)}'">
                    <div class="card__image">
                        ${item.category ? `<span class="tag-badge ${isCategoryActive ? 'active' : ''}" onclick="event.stopPropagation(); toggleCategoryInURL('${item.category}')">${item.category}</span>` : ''}
                        ${item.image ? `<img src="${item.image}" alt="${item.title}">` : '<i data-lucide="boxes" class="placeholder-icon icon--xl" aria-hidden="true"></i>'}
                    </div>
                    <div class="card__body">
                        <h3 class="card__title">${item.title}</h3>
                        <p class="card__subtitle">${item.description || item.category}</p>
                        ${hasTags ? `<div class="card__tags" data-tags='${JSON.stringify(item.tags)}'>${renderCardTagsHtml(cardId, item.tags, activeTags)}</div>` : ''}
                    </div>
                    <footer class="card__footer card__footer--end">
                        <span class="card__arrow-btn" aria-label="Details anzeigen">${arrowSvg}</span>
                    </footer>
                </article>
            `}).join('');
        }

        function renderModelsListItemsHTML(items, activeTags = [], activeCategory = '') {
            if (!items || items.length === 0) return renderNoResults(activeTags.length > 0 || activeCategory);

            const headerHtml = `
                <div class="list-header-row">
                    <div class="list-col-name">Name</div>
                    <div class="list-col-desc">Beschreibung</div>
                    <div class="list-col-tags">Tags</div>
                </div>
            `;

            const itemsHtml = items.map(item => {
                const isCategoryActive = activeCategory === item.category;
                return `
                <div class="element-list-item" onclick="window.location.hash='${buildHashWithTags('model/' + item.id, activeTags, activeCategory)}'">
                    <div class="list-col-name">
                        ${item.category ? `<span class="tag-badge ${isCategoryActive ? 'active' : ''}" style="margin-right:var(--space-sm);" onclick="event.stopPropagation(); toggleCategoryInURL('${item.category}')">${item.category}</span>` : ''}
                        ${item.title}
                    </div>
                    <div class="list-col-desc">${item.description || item.category}</div>
                    <div class="list-col-tags">${renderTagsHtml(item.tags, activeTags)}</div>
                </div>
            `}).join('');

            return `<div class="element-list-container">${headerHtml}${itemsHtml}</div>`;
        }

        // EPDs Grid/List Renderers
        function renderEpdsGridItemsHTML(items, activeTags = [], activeCategory = '') {
            if (!items || items.length === 0) return renderNoResults(activeTags.length > 0 || activeCategory);

            return items.map(item => {
                const hasTags = item.tags && Array.isArray(item.tags) && item.tags.length > 0;
                const cardId = `epd-${item.id}`;
                const isCategoryActive = activeCategory === item.category;

                return `
                <article class="card" data-card-id="${cardId}" onclick="window.location.hash='${buildHashWithTags('epd/' + item.id, activeTags, activeCategory)}'">
                    <div class="card__image">
                        ${item.category ? `<span class="tag-badge ${isCategoryActive ? 'active' : ''}" onclick="event.stopPropagation(); toggleCategoryInURL('${item.category}')">${item.category}</span>` : ''}
                        ${item.image ? `<img src="${item.image}" alt="${item.title}">` : '<i data-lucide="leaf" class="placeholder-icon icon--xl" aria-hidden="true"></i>'}
                    </div>
                    <div class="card__body">
                        <h3 class="card__title">${item.title}</h3>
                        <p class="card__subtitle">${item.description || item.category}</p>
                        ${hasTags ? `<div class="card__tags" data-tags='${JSON.stringify(item.tags)}'>${renderCardTagsHtml(cardId, item.tags, activeTags)}</div>` : ''}
                    </div>
                    <footer class="card__footer card__footer--end">
                        <span class="card__arrow-btn" aria-label="Details anzeigen">${arrowSvg}</span>
                    </footer>
                </article>
            `}).join('');
        }

        function renderEpdsListItemsHTML(items, activeTags = [], activeCategory = '') {
            if (!items || items.length === 0) return renderNoResults(activeTags.length > 0 || activeCategory);

            const headerHtml = `
                <div class="list-header-row">
                    <div class="list-col-name">Name</div>
                    <div class="list-col-desc">Beschreibung</div>
                    <div class="list-col-tags">Tags</div>
                </div>
            `;

            const itemsHtml = items.map(item => {
                const isCategoryActive = activeCategory === item.category;
                return `
                <div class="element-list-item" onclick="window.location.hash='${buildHashWithTags('epd/' + item.id, activeTags, activeCategory)}'">
                    <div class="list-col-name">
                        ${item.category ? `<span class="tag-badge ${isCategoryActive ? 'active' : ''}" style="margin-right:var(--space-sm);" onclick="event.stopPropagation(); toggleCategoryInURL('${item.category}')">${item.category}</span>` : ''}
                        ${item.title}
                    </div>
                    <div class="list-col-desc">${item.description || item.category}</div>
                    <div class="list-col-tags">${renderTagsHtml(item.tags, activeTags)}</div>
                </div>
            `}).join('');

            return `<div class="element-list-container">${headerHtml}${itemsHtml}</div>`;
        }

        function renderPhaseBadges(phases) {
            if(!phases || !Array.isArray(phases)) return '<span class="empty-text">-</span>';
            const allPhases = [1, 2, 3, 4, 5];
            let badgesHtml = '<div class="phase-compact-wrapper">';
            allPhases.forEach(phase => {
                const statusClass = phases.includes(phase) ? 'active' : 'inactive';
                badgesHtml += `<div class="phase-badge ${statusClass}" title="${phaseLabels[phase] || 'Phase ' + phase}">${phase}</div>`;
            });
            badgesHtml += '</div>';
            return badgesHtml;
        }

        // --- GLOBAL SEARCH (Homepage) ---
        function performGlobalSearch(query) {
            const results = {
                anwendungsfaelle: [],
                elemente: [],
                fachmodelle: [],
                dokumente: [],
                oekobilanzdaten: []
            };

            const searchTerm = query.toLowerCase().trim();
            if (searchTerm.length < 2) return results;

            // Search Elements
            results.elemente = globalElementsData
                .filter(el =>
                    el.title.toLowerCase().includes(searchTerm) ||
                    el.classification.toLowerCase().includes(searchTerm) ||
                    (el.description && el.description.toLowerCase().includes(searchTerm))
                )
                .slice(0, 3);

            // Search Documents
            results.dokumente = globalDocumentsData
                .filter(doc =>
                    doc.title.toLowerCase().includes(searchTerm) ||
                    doc.category.toLowerCase().includes(searchTerm) ||
                    (doc.description && doc.description.toLowerCase().includes(searchTerm))
                )
                .slice(0, 3);

            // Search Usecases
            results.anwendungsfaelle = globalUsecasesData
                .filter(item =>
                    item.title.toLowerCase().includes(searchTerm) ||
                    item.category.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm))
                )
                .slice(0, 3);

            // Search Models
            results.fachmodelle = globalModelsData
                .filter(item =>
                    item.title.toLowerCase().includes(searchTerm) ||
                    item.category.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm))
                )
                .slice(0, 3);

            // Search EPDs
            results.oekobilanzdaten = globalEpdsData
                .filter(item =>
                    item.title.toLowerCase().includes(searchTerm) ||
                    item.category.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm))
                )
                .slice(0, 3);

            return results;
        }

        function renderSearchDropdown(results, query) {
            const categories = [
                { key: 'anwendungsfaelle', label: 'Anwendungsfälle', hashPrefix: 'usecase' },
                { key: 'elemente', label: 'Elemente', hashPrefix: 'element' },
                { key: 'fachmodelle', label: 'Fachmodelle', hashPrefix: 'model' },
                { key: 'dokumente', label: 'Dokumente', hashPrefix: 'document' },
                { key: 'oekobilanzdaten', label: 'Ökobilanzdaten', hashPrefix: 'epd' }
            ];
            
            let hasAnyResults = false;
            let html = '';
            
            categories.forEach(cat => {
                const items = results[cat.key];
                if (items && items.length > 0) {
                    hasAnyResults = true;
                    html += `<div class="search-dropdown-group">`;
                    html += `<div class="search-dropdown-header">${cat.label}</div>`;
                    items.forEach(item => {
                        html += `<a class="search-dropdown-item" href="#${cat.hashPrefix}/${item.id}">${item.title}</a>`;
                    });
                    html += `</div>`;
                }
            });
            
            if (!hasAnyResults) {
                html = `<div class="search-dropdown-empty">Keine Ergebnisse für "${query}"</div>`;
            }

            // Add "Show all results" footer link
            const encodedQuery = encodeURIComponent(query);
            html += `<a class="search-dropdown-footer" href="#search?q=${encodedQuery}">
                Alle Ergebnisse anzeigen
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
            </a>`;

            return html;
        }

        // --- SEARCH CLEAR BUTTON HELPER ---
        function setupSearchClearButton(inputId, clearBtnId, onClear) {
            const input = document.getElementById(inputId);
            const clearBtn = document.getElementById(clearBtnId);

            if (!input || !clearBtn) return;

            // Update clear button visibility based on input value
            function updateClearVisibility() {
                if (input.value.length > 0) {
                    clearBtn.classList.add('visible');
                } else {
                    clearBtn.classList.remove('visible');
                }
            }

            // Show/hide clear button on input
            input.addEventListener('input', updateClearVisibility);

            // Clear input when button is clicked
            clearBtn.addEventListener('click', (e) => {
                e.preventDefault();
                input.value = '';
                clearBtn.classList.remove('visible');
                input.focus();
                if (onClear) onClear();
            });

            // Initial visibility check
            updateClearVisibility();
        }

        function setupGlobalSearch() {
            const searchInput = document.getElementById('globalSearchInput');
            const searchDropdown = document.getElementById('globalSearchDropdown');
            
            if (!searchInput || !searchDropdown) return;
            
            let debounceTimer;
            
            searchInput.addEventListener('input', (e) => {
                clearTimeout(debounceTimer);
                const query = e.target.value;
                
                if (query.length < 2) {
                    searchDropdown.classList.remove('open');
                    return;
                }
                
                debounceTimer = setTimeout(() => {
                    const results = performGlobalSearch(query);
                    searchDropdown.innerHTML = renderSearchDropdown(results, query);
                    searchDropdown.classList.add('open');
                }, 150);
            });
            
            // Close dropdown on click outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.gallery-filter-container') && !e.target.closest('.home-search-container')) {
                    searchDropdown.classList.remove('open');
                }
            });
            
            // Close dropdown on Escape
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    searchDropdown.classList.remove('open');
                    searchInput.blur();
                }
            });
            
            // Close dropdown and navigate on result click
            searchDropdown.addEventListener('click', (e) => {
                if (e.target.classList.contains('search-dropdown-item') ||
                    e.target.classList.contains('search-dropdown-footer')) {
                    searchDropdown.classList.remove('open');
                    searchInput.value = '';
                    // Hide clear button
                    const clearBtn = document.getElementById('globalSearchClear');
                    if (clearBtn) clearBtn.classList.remove('visible');
                }
            });

            // Setup clear button
            setupSearchClearButton('globalSearchInput', 'globalSearchClear', () => {
                searchDropdown.classList.remove('open');
            });
        }

        // --- HEADER SEARCH (Progressive Disclosure Toggle) ---
        function setupHeaderSearch() {
            const toggle = document.getElementById('headerSearchToggle');
            const searchContainer = document.querySelector('.header__search');
            const form = document.getElementById('headerSearchForm');
            const input = document.getElementById('headerSearchInput');

            if (!toggle || !searchContainer || !form || !input) return;

            let isExpanded = false;

            function expandSearch() {
                isExpanded = true;
                searchContainer.classList.add('open');
                toggle.setAttribute('aria-expanded', 'true');
                // Delay focus slightly to allow animation to start
                setTimeout(() => input.focus(), 100);
            }

            function collapseSearch() {
                isExpanded = false;
                searchContainer.classList.remove('open');
                toggle.setAttribute('aria-expanded', 'false');
            }

            // Toggle search form visibility
            toggle.addEventListener('click', (e) => {
                e.preventDefault();
                if (!isExpanded) {
                    expandSearch();
                }
            });

            // Handle form submission
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const query = input.value.trim();
                if (query.length >= 2) {
                    collapseSearch();
                    window.location.hash = `search?q=${encodeURIComponent(query)}`;
                }
            });

            // Close on click outside
            document.addEventListener('click', (e) => {
                if (isExpanded && !e.target.closest('.header__search')) {
                    collapseSearch();
                }
            });

            // Close on Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && isExpanded) {
                    collapseSearch();
                    toggle.focus(); // Return focus to toggle for accessibility
                }
            });

            // Setup clear button
            setupSearchClearButton('headerSearchInput', 'headerSearchClear');
        }

        // --- FULL SEARCH (Search Results Page) ---
        function performFullSearch(query) {
            const results = [];
            const searchTerm = query.toLowerCase().trim();
            if (searchTerm.length < 2) return results;

            // Search Use Cases
            globalUsecasesData.forEach(item => {
                if (item.title.toLowerCase().includes(searchTerm) ||
                    item.category.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm))) {
                    results.push({
                        type: 'Artikel',
                        category: 'usecase',
                        id: item.id,
                        title: item.title,
                        description: item.description || '',
                        date: item.date || null
                    });
                }
            });

            // Search Elements
            globalElementsData.forEach(item => {
                if (item.title.toLowerCase().includes(searchTerm) ||
                    item.classification.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm))) {
                    results.push({
                        type: 'Element',
                        category: 'element',
                        id: item.id,
                        title: item.title,
                        description: item.description || item.classification || '',
                        date: item.date || null
                    });
                }
            });

            // Search Models
            globalModelsData.forEach(item => {
                if (item.title.toLowerCase().includes(searchTerm) ||
                    item.category.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm))) {
                    results.push({
                        type: 'Artikel',
                        category: 'model',
                        id: item.id,
                        title: item.title,
                        description: item.description || '',
                        date: item.date || null
                    });
                }
            });

            // Search Documents
            globalDocumentsData.forEach(item => {
                if (item.title.toLowerCase().includes(searchTerm) ||
                    item.category.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm))) {
                    results.push({
                        type: 'Artikel',
                        category: 'document',
                        id: item.id,
                        title: item.title,
                        description: item.description || '',
                        date: item.date || null
                    });
                }
            });

            // Search EPDs
            globalEpdsData.forEach(item => {
                if (item.title.toLowerCase().includes(searchTerm) ||
                    item.category.toLowerCase().includes(searchTerm) ||
                    (item.description && item.description.toLowerCase().includes(searchTerm))) {
                    results.push({
                        type: 'Artikel',
                        category: 'epd',
                        id: item.id,
                        title: item.title,
                        description: item.description || '',
                        date: item.date || null
                    });
                }
            });

            // Sort results by date (newest first)
            if (currentSearchSort === 'date-desc') {
                results.sort((a, b) => {
                    if (!a.date && !b.date) return 0;
                    if (!a.date) return 1;
                    if (!b.date) return -1;
                    return new Date(b.date) - new Date(a.date);
                });
            } else if (currentSearchSort === 'date-asc') {
                results.sort((a, b) => {
                    if (!a.date && !b.date) return 0;
                    if (!a.date) return 1;
                    if (!b.date) return -1;
                    return new Date(a.date) - new Date(b.date);
                });
            }

            return results;
        }

        function formatSearchDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            if (isNaN(date.getTime())) return '';
            return date.toLocaleDateString('de-CH', { day: 'numeric', month: 'long', year: 'numeric' });
        }

        function renderSearchResultsPage(query) {
            currentSearchQuery = query || '';
            const results = performFullSearch(currentSearchQuery);
            const resultCount = results.length;

            let resultsHtml = '';
            if (resultCount === 0 && currentSearchQuery.length >= 2) {
                resultsHtml = `
                    <div class="search-results__empty">
                        <div class="search-results__empty-icon"><i data-lucide="search-x" aria-hidden="true"></i></div>
                        <h3 class="search-results__empty-title">Keine Ergebnisse gefunden</h3>
                        <p class="search-results__empty-text">Versuchen Sie es mit anderen Suchbegriffen.</p>
                    </div>
                `;
            } else if (getActiveViewFromURL() === 'list') {
                resultsHtml = `<div class="search-results__list">`;
                results.forEach(item => {
                    const dateStr = formatSearchDate(item.date);
                    resultsHtml += `
                        <div class="search-result-item">
                            <div class="search-result-item__meta">
                                <span class="search-result-item__type">${item.type}</span>
                                ${dateStr ? `<span class="search-result-item__date">${dateStr}</span>` : ''}
                            </div>
                            <h3 class="search-result-item__title"><a href="#${item.category}/${item.id}">${item.title}</a></h3>
                            <p class="search-result-item__desc">${item.description}</p>
                        </div>
                    `;
                });
                resultsHtml += `</div>`;
            } else {
                resultsHtml = `<div class="search-results__grid">`;
                results.forEach(item => {
                    const dateStr = formatSearchDate(item.date);
                    resultsHtml += `
                        <div class="search-result-card">
                            <div class="search-result-card__meta">
                                <span class="search-result-card__type">${item.type}</span>
                                ${dateStr ? `<span class="search-result-card__date">${dateStr}</span>` : ''}
                            </div>
                            <h3 class="search-result-card__title"><a href="#${item.category}/${item.id}">${item.title}</a></h3>
                            <p class="search-result-card__desc">${item.description}</p>
                            <div class="search-result-card__footer">
                                <a href="#${item.category}/${item.id}" class="search-result-card__link" aria-label="${item.title} öffnen">
                                    <i data-lucide="arrow-right" aria-hidden="true"></i>
                                </a>
                            </div>
                        </div>
                    `;
                });
                resultsHtml += `</div>`;
            }

            contentArea.innerHTML = `
                <div class="search-hero">
                    <div class="container">
                        <h1 class="search-hero__title">Suche</h1>
                        <form class="search-hero__form" id="searchPageForm" role="search">
                            <div class="search-hero__input-wrapper">
                                <input type="search" id="searchPageInput" class="search-hero__input" value="${currentSearchQuery}" placeholder="Suchbegriff eingeben..." autocomplete="off">
                                <button type="button" class="search-hero__clear ${currentSearchQuery ? 'visible' : ''}" id="searchPageClear" aria-label="Suche löschen">
                                    <i data-lucide="x" aria-hidden="true"></i>
                                </button>
                                <button type="submit" class="search-hero__submit" aria-label="Suchen">
                                    <i data-lucide="search" aria-hidden="true"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="search-results">
                    <div class="container">
                        ${currentSearchQuery.length >= 2 ? `
                        <div class="search-results__header">
                            <span class="search-results__count">${resultCount} Suchergebnisse</span>
                            <div class="search-results__controls">
                                <button class="search-results__sort" onclick="toggleSearchSort()">
                                    <span>${currentSearchSort === 'date-desc' ? 'Nach Datum sortieren (Absteigend)' : 'Nach Datum sortieren (Aufsteigend)'}</span>
                                    <i data-lucide="chevron-down" aria-hidden="true"></i>
                                </button>
                                <div class="view-switcher toolbar-control">
                                    <button class="view-btn ${getActiveViewFromURL() === 'list' ? 'active' : ''}" onclick="switchSearchView('list')" title="Listenansicht" aria-label="Listenansicht">
                                        <i data-lucide="list" aria-hidden="true"></i>
                                    </button>
                                    <button class="view-btn ${getActiveViewFromURL() === 'grid' ? 'active' : ''}" onclick="switchSearchView('grid')" title="Rasteransicht" aria-label="Rasteransicht">
                                        <i data-lucide="layout-grid" aria-hidden="true"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        ` : ''}
                        ${resultsHtml}
                    </div>
                </div>
            `;

            // Setup search form on results page
            const searchForm = document.getElementById('searchPageForm');
            const searchInput = document.getElementById('searchPageInput');
            if (searchForm && searchInput) {
                searchForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const newQuery = searchInput.value.trim();
                    if (newQuery.length >= 2) {
                        const view = getActiveViewFromURL();
                        const viewParam = view !== 'grid' ? `&view=${view}` : '';
                        window.location.hash = `search?q=${encodeURIComponent(newQuery)}${viewParam}`;
                    }
                });
            }

            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Setup clear button
            setupSearchClearButton('searchPageInput', 'searchPageClear');
        }

        window.switchSearchView = function(view) {
            // Update URL with view parameter for search results
            const currentView = getActiveViewFromURL();
            if (view !== currentView) {
                const newHash = currentSearchQuery
                    ? `search?q=${encodeURIComponent(currentSearchQuery)}&view=${view}`
                    : `search?view=${view}`;
                window.location.hash = newHash;
            }
        };

        window.toggleSearchSort = function() {
            currentSearchSort = currentSearchSort === 'date-desc' ? 'date-asc' : 'date-desc';
            renderSearchResultsPage(currentSearchQuery);
        };

        // --- PAGE RENDERERS ---
        function renderHomePage() {
            contentArea.innerHTML = `
                <div class="home-hero-section">
                    <h1 class="home-hero__title">Fachdatenkatalog für die digitale Bauwerksdokumentation</h1>
                    <p class="hero__description">Der Fachdatenkatalog der KBOB definiert standardisierte Anforderungen an die BIM-basierte Dokumentation von Hochbauprojekten der öffentlichen Hand in der Schweiz. Er dient als Grundlage für Auftraggeber-Informationsanforderungen (AIA) und BIM-Abwicklungspläne (BAP).</p>
                    <div class="home-search-container">
                        <div class="gallery-filter-wrapper">
                            <input type="text" id="globalSearchInput" class="gallery-filter-input" placeholder="Suche nach Elementen oder Dokumenten..." autocomplete="off">
                            <button type="button" class="search-clear-btn" id="globalSearchClear" aria-label="Suche löschen"><i data-lucide="x" aria-hidden="true"></i></button>
                            <button class="gallery-filter-btn" aria-label="Suchen"><i data-lucide="search" aria-hidden="true"></i></button>
                        </div>
                        <div id="globalSearchDropdown" class="search-dropdown"></div>
                    </div>
                </div>

                <!-- Section 2: Themen - Light Background -->
                <section class="home-themen-section">
                    <div class="container home-section">
                        <header class="home-section__header">
                            <h2 class="home-section__title">Themen</h2>
                            <p class="home-section__subtitle">Entdecken Sie die verschiedenen Bereiche des Fachdatenkatalogs</p>
                        </header>
                        <div class="quick-access-grid">
                            <a href="#usecases" class="quick-card" data-route="usecases">
                                <h3 class="quick-card__title">Anwendungsfälle</h3>
                                <p class="quick-card__desc">BIM-Anwendungsfälle für Planung, Koordination und Betrieb</p>
                                <span class="quick-card__arrow-btn" aria-hidden="true"><i data-lucide="arrow-right"></i></span>
                            </a>
                            <a href="#elements" class="quick-card" data-route="elements">
                                <h3 class="quick-card__title">Elemente</h3>
                                <p class="quick-card__desc">Standardisierte BIM-Elemente für den Hochbau mit LOD- und LOI-Anforderungen</p>
                                <span class="quick-card__arrow-btn" aria-hidden="true"><i data-lucide="arrow-right"></i></span>
                            </a>
                            <a href="#models" class="quick-card" data-route="models">
                                <h3 class="quick-card__title">Fachmodelle</h3>
                                <p class="quick-card__desc">Domänenspezifische Modelle für Architektur, Statik und Gebäudetechnik</p>
                                <span class="quick-card__arrow-btn" aria-hidden="true"><i data-lucide="arrow-right"></i></span>
                            </a>
                            <a href="#documents" class="quick-card" data-route="documents">
                                <h3 class="quick-card__title">Dokumente</h3>
                                <p class="quick-card__desc">Dokumenttypen und Vorlagen für die Bauwerksdokumentation</p>
                                <span class="quick-card__arrow-btn" aria-hidden="true"><i data-lucide="arrow-right"></i></span>
                            </a>
                            <a href="#epds" class="quick-card" data-route="epds">
                                <h3 class="quick-card__title">Ökobilanzdaten</h3>
                                <p class="quick-card__desc">Umweltkennwerte für Baumaterialien und Gebäudetechnik</p>
                                <span class="quick-card__arrow-btn" aria-hidden="true"><i data-lucide="arrow-right"></i></span>
                            </a>
                        </div>
                    </div>
                </section>`;

            setupGlobalSearch();

            // Initialize lucide icons for new content
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Setup quick card navigation
            document.querySelectorAll('.quick-card[data-route]').forEach(card => {
                card.addEventListener('click', (e) => {
                    e.preventDefault();
                    const route = card.dataset.route;
                    if (route) {
                        window.location.hash = route;
                    }
                });
            });
        }

        function renderHandbookPage() {
            contentArea.innerHTML = `
                <div class="container">
                    <div class="page-header">
                        <h1 class="page-title">Handbuch & Downloads</h1>
                        <p class="page-lead">Alle Ressourcen zur Bauwerksdokumentation im Hochbau: Vorlagen, Prüfdateien und technische Schnittstellen.</p>
                    </div>

                    <div class="handbook-accordion">
                        <!-- Downloads Section -->
                        <div class="accordion-item open">
                            <button class="accordion-header" aria-expanded="true">
                                <h2 class="accordion-title">Downloads</h2>
                                <i data-lucide="chevron-down" class="accordion-icon" aria-hidden="true"></i>
                            </button>
                            <div class="accordion-content">
                                <p class="accordion-description">Vorlagen und Prüfdateien für die digitale Bauwerksdokumentation.</p>
                                <ul class="download-list">
                                    <li class="download-item">
                                        <i data-lucide="download" class="download-item__icon" aria-hidden="true"></i>
                                        <div class="download-item__content">
                                            <a href="#" class="download-item__link">EIR-Excel</a>
                                            <div class="download-item__meta">
                                                <span>XLSX</span>
                                                <span>245 kB</span>
                                                <span>15. Oktober 2024</span>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="download-item">
                                        <i data-lucide="download" class="download-item__icon" aria-hidden="true"></i>
                                        <div class="download-item__content">
                                            <a href="#" class="download-item__link">IDS-Prüfregeln</a>
                                            <div class="download-item__meta">
                                                <span>ZIP</span>
                                                <span>128 kB</span>
                                                <span>15. Oktober 2024</span>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Dokumentation Section -->
                        <div class="accordion-item open">
                            <button class="accordion-header" aria-expanded="true">
                                <h2 class="accordion-title">Dokumentation</h2>
                                <i data-lucide="chevron-down" class="accordion-icon" aria-hidden="true"></i>
                            </button>
                            <div class="accordion-content">
                                <p class="accordion-description">Anleitungen und Referenzmaterial für die Anwendung des Fachdatenkatalogs.</p>
                                <ul class="download-list">
                                    <li class="download-item">
                                        <i data-lucide="download" class="download-item__icon" aria-hidden="true"></i>
                                        <div class="download-item__content">
                                            <a href="#" class="download-item__link">Anwendungshandbuch</a>
                                            <div class="download-item__meta">
                                                <span>PDF</span>
                                                <span>2.4 MB</span>
                                                <span>23. September 2024</span>
                                            </div>
                                        </div>
                                    </li>
                                    <li class="download-item">
                                        <i data-lucide="download" class="download-item__icon" aria-hidden="true"></i>
                                        <div class="download-item__content">
                                            <a href="#" class="download-item__link">API-Dokumentation</a>
                                            <div class="download-item__meta">
                                                <span>PDF</span>
                                                <span>890 kB</span>
                                                <span>23. September 2024</span>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <!-- Vernetzte Datenquellen Section -->
                        <div class="accordion-item open">
                            <button class="accordion-header" aria-expanded="true">
                                <h2 class="accordion-title">Vernetzte Datenquellen</h2>
                                <i data-lucide="chevron-down" class="accordion-icon" aria-hidden="true"></i>
                            </button>
                            <div class="accordion-content">
                                <p class="accordion-description">Nationale Dateninfrastrukturen und verknüpfte Dienste.</p>
                                <div class="external-item">
                                    <i data-lucide="database" class="external-item__icon" aria-hidden="true"></i>
                                    <a href="https://lindas.admin.ch/" target="_blank" rel="noopener" class="external-item__link">
                                        LINDAS – Linked Data Service
                                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                                    </a>
                                </div>
                                <div class="external-item">
                                    <i data-lucide="share-2" class="external-item__icon" aria-hidden="true"></i>
                                    <a href="https://www.i14y.admin.ch/de/home" target="_blank" rel="noopener" class="external-item__link">
                                        I14Y – Interoperabilitätsplattform
                                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                                    </a>
                                </div>
                                <div class="external-item">
                                    <i data-lucide="languages" class="external-item__icon" aria-hidden="true"></i>
                                    <a href="https://www.termdat.bk.admin.ch/" target="_blank" rel="noopener" class="external-item__link">
                                        TERMDAT – Terminologiedatenbank
                                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                                    </a>
                                </div>
                                <div class="external-item">
                                    <i data-lucide="book-open" class="external-item__icon" aria-hidden="true"></i>
                                    <a href="https://www.buildingsmart.org/users/services/buildingsmart-data-dictionary/" target="_blank" rel="noopener" class="external-item__link">
                                        bSDD – buildingSMART Data Dictionary
                                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- APIs Section -->
                        <div class="accordion-item open">
                            <button class="accordion-header" aria-expanded="true">
                                <h2 class="accordion-title">APIs</h2>
                                <i data-lucide="chevron-down" class="accordion-icon" aria-hidden="true"></i>
                            </button>
                            <div class="accordion-content">
                                <p class="accordion-description">Programmatische Schnittstellen für den Datenzugriff.</p>
                                <div class="external-item">
                                    <i data-lucide="arrow-right-left" class="external-item__icon" aria-hidden="true"></i>
                                    <a href="#" class="external-item__link">
                                        REST API
                                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                                    </a>
                                </div>
                                <div class="external-item">
                                    <i data-lucide="git-branch" class="external-item__icon" aria-hidden="true"></i>
                                    <a href="#" class="external-item__link">
                                        GraphQL API
                                        <i data-lucide="external-link" class="external-icon" aria-hidden="true"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;

            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Initialize accordion functionality
            initAccordion();
        }

        function initAccordion() {
            document.querySelectorAll('.accordion-header').forEach(header => {
                header.addEventListener('click', () => {
                    const item = header.parentElement;
                    const isOpen = item.classList.contains('open');

                    // Toggle current item
                    item.classList.toggle('open');
                    header.setAttribute('aria-expanded', !isOpen);
                });
            });
        }

        function renderCatalogPage(activeTags = [], activeCategory = '') {
            // Apply both category and tag filtering
            let filteredData = filterDataByCategory(globalElementsData, activeCategory);
            filteredData = filterDataByTags(filteredData, activeTags);

            const filterPanelClass = elementsFilterVisible ? '' : 'closed';
            const currentView = getActiveViewFromURL();
            const gridActive = currentView === 'grid' ? 'active' : '';
            const listActive = currentView === 'list' ? 'active' : '';
            const activeFiltersCount = activeTags.length + (activeCategory ? 1 : 0);

            contentArea.innerHTML = `
                <div class="container">
                    <div class="page-header">
                        <h1 class="page-title">Elemente</h1>
                        <p class="page-lead">Standardisierte BIM-Elemente für den Hochbau mit LOD- und LOI-Anforderungen pro Projektphase.</p>
                    </div>
                    <div class="gallery-filter-container">
                        <div class="gallery-filter-left">
                            <div class="gallery-filter-wrapper">
                                <input type="text" id="catalogSearchInput" class="gallery-filter-input" placeholder="Suche nach Elementen oder Klassifikation...">
                                <button type="button" class="search-clear-btn" id="catalogSearchClear" aria-label="Suche löschen"><i data-lucide="x" aria-hidden="true"></i></button>
                                <button class="gallery-filter-btn" aria-label="Suchen"><i data-lucide="search" aria-hidden="true"></i></button>
                            </div>
                            ${renderFilterButton('elements', elementsFilterVisible, activeFiltersCount)}
                        </div>
                        <div class="view-switcher toolbar-control">
                            <button class="view-btn ${listActive}" onclick="switchView('list')" aria-label="Listenansicht"><i data-lucide="list" aria-hidden="true"></i></button>
                            <button class="view-btn ${gridActive}" onclick="switchView('grid')" aria-label="Rasteransicht"><i data-lucide="layout-grid" aria-hidden="true"></i></button>
                        </div>
                    </div>

                    ${renderFilterBar({
                        data: globalElementsData,
                        activeTags: activeTags,
                        activeCategory: activeCategory,
                        filterPanelClass: filterPanelClass
                    })}

                    <div id="catalogContent" class="catalog-content">
                        ${currentView === 'grid'
                            ? `<div class="element-grid">${renderGridItemsHTML(filteredData, activeTags, activeCategory)}</div>`
                            : renderListItemsHTML(filteredData, activeTags, activeCategory)
                        }
                    </div>
                </div>`;

            const searchInput = document.getElementById('catalogSearchInput');
            if(searchInput) {
                searchInput.addEventListener('input', (e) => {
                    document.querySelectorAll('.az-btn').forEach(b => b.classList.remove('active'));
                    const searchTerm = e.target.value.toLowerCase();

                    // First filter by category and tags, then by search term
                    let searchFilteredData = filterDataByCategory(globalElementsData, activeCategory);
                    searchFilteredData = filterDataByTags(searchFilteredData, activeTags);
                    searchFilteredData = searchFilteredData.filter(el =>
                        el.title.toLowerCase().includes(searchTerm) ||
                        (el.classification && el.classification.toLowerCase().includes(searchTerm))
                    );

                    const container = document.getElementById('catalogContent');
                    container.innerHTML = (getActiveViewFromURL() === 'grid')
                        ? `<div class="element-grid">${renderGridItemsHTML(searchFilteredData, activeTags, activeCategory)}</div>`
                        : renderListItemsHTML(searchFilteredData, activeTags, activeCategory);
                });
            }

            // Re-initialize Lucide icons after rendering
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Setup clear button
            setupSearchClearButton('catalogSearchInput', 'catalogSearchClear');
        }

        function renderDocumentsCatalogPage(activeTags = [], activeCategory = '') {
            // Apply both category and tag filtering
            let filteredData = filterDataByCategory(globalDocumentsData, activeCategory);
            filteredData = filterDataByTags(filteredData, activeTags);

            const filterPanelClass = documentsFilterVisible ? '' : 'closed';
            const currentView = getActiveViewFromURL();
            const gridActive = currentView === 'grid' ? 'active' : '';
            const listActive = currentView === 'list' ? 'active' : '';
            const activeFiltersCount = activeTags.length + (activeCategory ? 1 : 0);

            contentArea.innerHTML = `
                <div class="container">
                    <div class="page-header">
                        <h1 class="page-title">Dokumente</h1>
                        <p class="page-lead">Dokumenttypen und Vorlagen für die standardisierte Bauwerksdokumentation im Hochbau.</p>
                    </div>
                    <div class="gallery-filter-container">
                        <div class="gallery-filter-left">
                            <div class="gallery-filter-wrapper">
                                <input type="text" id="documentsSearchInput" class="gallery-filter-input" placeholder="Suche nach Dokumenten oder Kategorie...">
                                <button type="button" class="search-clear-btn" id="documentsSearchClear" aria-label="Suche löschen"><i data-lucide="x" aria-hidden="true"></i></button>
                                <button class="gallery-filter-btn" aria-label="Suchen"><i data-lucide="search" aria-hidden="true"></i></button>
                            </div>
                            ${renderFilterButton('documents', documentsFilterVisible, activeFiltersCount)}
                        </div>
                        <div class="view-switcher toolbar-control">
                            <button class="view-btn ${listActive}" onclick="switchView('list')" aria-label="Listenansicht"><i data-lucide="list" aria-hidden="true"></i></button>
                            <button class="view-btn ${gridActive}" onclick="switchView('grid')" aria-label="Rasteransicht"><i data-lucide="layout-grid" aria-hidden="true"></i></button>
                        </div>
                    </div>

                    ${renderFilterBar({
                        data: globalDocumentsData,
                        activeTags: activeTags,
                        activeCategory: activeCategory,
                        filterPanelClass: filterPanelClass
                    })}

                    <div id="documentsContent" class="catalog-content">
                        ${currentView === 'grid'
                            ? `<div class="element-grid">${renderDocGridItemsHTML(filteredData, activeTags, activeCategory)}</div>`
                            : renderDocListItemsHTML(filteredData, activeTags, activeCategory)
                        }
                    </div>
                </div>`;

            const searchInput = document.getElementById('documentsSearchInput');
            if(searchInput) {
                searchInput.addEventListener('input', (e) => {
                    document.querySelectorAll('.az-btn').forEach(b => b.classList.remove('active'));
                    const searchTerm = e.target.value.toLowerCase();

                    // First filter by category and tags, then by search term
                    let searchFilteredData = filterDataByCategory(globalDocumentsData, activeCategory);
                    searchFilteredData = filterDataByTags(searchFilteredData, activeTags);
                    searchFilteredData = searchFilteredData.filter(doc =>
                        doc.title.toLowerCase().includes(searchTerm) ||
                        doc.category.toLowerCase().includes(searchTerm) ||
                        doc.description.toLowerCase().includes(searchTerm)
                    );

                    const container = document.getElementById('documentsContent');
                    container.innerHTML = (getActiveViewFromURL() === 'grid')
                        ? `<div class="element-grid">${renderDocGridItemsHTML(searchFilteredData, activeTags, activeCategory)}</div>`
                        : renderDocListItemsHTML(searchFilteredData, activeTags, activeCategory);
                });
            }

            // Re-initialize Lucide icons after rendering
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Setup clear button
            setupSearchClearButton('documentsSearchInput', 'documentsSearchClear');
        }

        function renderElementDetailPage(id, activeTags = []) {
            const data = globalElementsData.find(element => element.id === id);
            if(!data) { 
                contentArea.innerHTML = '<div class="container error-state">Element nicht gefunden.</div>'; 
                return; 
            }

            const sidebarLinks = [
                { id: 'klassifizierung', text: 'Klassifizierung' },
                { id: 'ifc', text: 'IFC-Klasse' },
                { id: 'geometrie', text: 'Geometrie' },
                { id: 'informationen', text: 'Informationen' },
                { id: 'dokumentation', text: 'Dokumentation' }
            ].map(link => `<a href="#${link.id}" class="sidebar-link" data-target="${link.id}">${link.text}</a>`).join('');

            const classRows = data.classifications 
                ? data.classifications.map(c => `<tr><td class="col-val">${c.system}</td><td class="col-val">${c.code} - ${c.desc}</td></tr>`).join('') 
                : '<tr><td colspan="2">Keine Klassifizierung verfügbar</td></tr>';

            const ifcRows = data.ifcMapping 
                ? data.ifcMapping.map(m => `
                    <tr>
                        <td class="col-val">${m.element}</td>
                        <td class="col-val">${m.ifc}</td>
                        <td class="col-val">${m.revit}</td>
                    </tr>`).join('') 
                : '<tr><td colspan="3">-</td></tr>';

            const geomRows = data.geometry && data.geometry.length > 0 ? data.geometry : [];
            const geomRowsHtml = geomRows.length > 0 
                ? geomRows.map(row => `
                    <tr>
                        <td class="col-val">${row.name}</td>
                        <td class="col-val">${row.desc}</td>
                        <td class="col-center">${renderPhaseBadges(row.phases)}</td>
                    </tr>`).join('') 
                : '<tr><td colspan="3" class="col-center empty-text">Keine Daten.</td></tr>';

            const infoRows = data.information && data.information.length > 0 ? data.information : [];
            const infoRowsHtml = infoRows.length > 0 
                ? infoRows.map(row => `
                    <tr>
                        <td class="col-val"><span class="info-name-tooltip" title="${row.desc || ''}">${row.name}</span></td>
                        <td class="col-val">${row.format || '-'}</td>
                        <td class="col-center">${row.list ? '<i data-lucide="circle-check" class="list-icon-active"></i>' : '-'}</td>
                        <td class="col-val">${row.ifc || '-'}</td>
                        <td class="col-center">${renderPhaseBadges(row.phases)}</td>
                    </tr>`).join('') 
                : '<tr><td colspan="5" class="col-center empty-text">Keine Attribute (LOI).</td></tr>';

            const docRows = data.documentation && data.documentation.length > 0 ? data.documentation : [];
            const docRowsHtml = docRows.length > 0 
                ? docRows.map(row => `
                    <tr>
                        <td class="col-val">${row.name}</td>
                        <td class="col-val">${row.desc}</td>
                        <td class="col-center">${renderPhaseBadges(row.phases)}</td>
                    </tr>`).join('') 
                : '<tr><td colspan="3" class="col-center empty-text">Keine Dokumente.</td></tr>';

            // Build back link with tags and view preserved
            const backLink = buildHashWithTags('elements', activeTags, '', [], getActiveViewFromURL());

            contentArea.innerHTML = `
                <section class="detail-hero">
                    <div class="container detail-hero__inner">
                        <div class="hero-content">
                            <div class="breadcrumb"><a href="#${backLink}"><i data-lucide="arrow-left" style="vertical-align: text-bottom; margin-right:5px; width: 1.1rem; height: 1.1rem;"></i> Zurück zur Liste</a></div>
                            <h1 class="hero-title">${data.title}</h1>
                            <p class="hero-subtitle">${data.description || 'Ein Standard-Element des KBOB Datenkatalogs.'}</p>
                            <div class="hero-tags">${renderTagsHtml(data.tags, activeTags)}</div>
                        </div>
                        <div class="hero-image-container">
                            ${data.image ? `<img src="${data.image}" alt="${data.title}">` : '<i data-lucide="image" class="hero-image-placeholder icon--4xl"></i>'}
                        </div>
                    </div>
                </section>

                <div class="container">
                    <div class="detail-layout">
                        <aside class="detail-sidebar"><nav class="sticky-nav">${sidebarLinks}</nav></aside>
                        <div class="detail-content-area">
                            <div id="klassifizierung" class="detail-section">
                                <h2>Klassifizierung</h2>
                                <table class="data-table">
                                    <thead><tr><th class="th-w-20">Klassifizierung</th><th>Nummer - Beschreibung</th></tr></thead>
                                    <tbody>${classRows}</tbody>
                                </table>
                            </div>
                            
                            <div id="ifc" class="detail-section">
                                <h2>IFC-Klasse</h2>
                                <table class="data-table">
                                    <thead><tr><th class="th-w-20">Element</th><th>IFC 4.3</th><th>Revit ENG</th></tr></thead>
                                    <tbody>${ifcRows}</tbody>
                                </table>
                            </div>
                            
                            <div id="geometrie" class="detail-section">
                                <h2>Geometrie</h2>
                                <p>Definiert die geometrischen Anforderungen an das Modellelement pro Phase.</p>
                                <table class="data-table">
                                    <thead><tr><th class="th-w-20">Element</th><th>Beschreibung</th><th class="th-w-phases">Phasen (1-5)</th></tr></thead>
                                    <tbody>${geomRowsHtml}</tbody>
                                </table>
                            </div>
                            
                            <div id="informationen" class="detail-section">
                                <h2>Informationen</h2>
                                <p>Alphanumerische Attribute (LOI), die dem Element zugewiesen werden müssen.</p>
                                <table class="data-table">
                                    <thead><tr>
                                        <th class="th-w-20">Name</th>
                                        <th class="th-w-format">Format</th>
                                        <th class="th-w-list">Liste</th>
                                        <th>IFC Mapping</th>
                                        <th class="th-w-phases">Phasen (1-5)</th>
                                    </tr></thead>
                                    <tbody>${infoRowsHtml}</tbody>
                                </table>
                            </div>
                            
                            <div id="dokumentation" class="detail-section">
                                <h2>Dokumentation</h2>
                                <p>Erforderliche Dokumente, die mit dem Element verknüpft oder geliefert werden müssen.</p>
                                <table class="data-table">
                                    <thead><tr><th class="th-w-20">Dokumententyp</th><th>Beschreibung</th><th class="th-w-phases">Phasen (1-5)</th></tr></thead>
                                    <tbody>${docRowsHtml}</tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>`;
            
            setupDetailInteractions();
        }

        function renderDocumentDetailPage(id, activeTags = [], activeCategory = '') {
            const data = globalDocumentsData.find(doc => doc.id === id);
            if(!data) {
                contentArea.innerHTML = '<div class="container error-state">Dokument nicht gefunden. Detail-Seite für Dokumente ist noch in Entwicklung.</div>';
                return;
            }

            // Build back link with tags, category, and view preserved
            const backLink = buildHashWithTags('documents', activeTags, activeCategory, [], getActiveViewFromURL());
            
            contentArea.innerHTML = `
                <section class="detail-hero">
                    <div class="container detail-hero__inner">
                        <div class="hero-content">
                            <div class="breadcrumb"><a href="#${backLink}"><i data-lucide="arrow-left" style="vertical-align: text-bottom; margin-right:5px; width: 1.1rem; height: 1.1rem;"></i> Zurück zur Liste</a></div>
                            <h1 class="hero-title">${data.title}</h1>
                            <p class="hero-subtitle">${data.description || 'Ein Dokument des KBOB Datenkatalogs.'}</p>
                            <div class="hero-tags">${renderTagsHtml(data.tags, activeTags)}</div>
                        </div>
                        <div class="hero-image-container">
                            ${data.image ? `<img src="${data.image}" alt="${data.title}">` : '<i data-lucide="file-text" class="hero-image-placeholder icon--4xl"></i>'}
                        </div>
                    </div>
                </section>
                <div class="container">
                    <div class="info-box info-box--centered">
                        <i data-lucide="hard-hat" class="info-box__icon icon--4xl"></i>
                        <h2 class="info-box__title">In Entwicklung</h2>
                        <p class="info-box__text">Die Detail-Ansicht für Dokumente wird derzeit entwickelt.</p>
                    </div>
                </div>`;
        }

        // ============================================
        // USECASES CATALOG AND DETAIL PAGES
        // ============================================

        function renderUsecasesCatalogPage(activeTags = [], activeCategory = '') {
            // Get active phases from URL
            const activePhases = getActivePhasesFromURL();

            // Apply category, tag, and phases filtering
            let filteredData = filterDataByCategory(globalUsecasesData, activeCategory);
            filteredData = filterDataByTags(filteredData, activeTags);
            filteredData = filterDataByPhases(filteredData, activePhases);

            const filterPanelClass = usecasesFilterVisible ? '' : 'closed';
            const currentView = getActiveViewFromURL();
            const gridActive = currentView === 'grid' ? 'active' : '';
            const listActive = currentView === 'list' ? 'active' : '';
            const activeFiltersCount = activeTags.length + (activeCategory ? 1 : 0) + activePhases.length;

            contentArea.innerHTML = `
                <div class="container">
                    <div class="page-header">
                        <h1 class="page-title">Anwendungsfälle</h1>
                        <p class="page-lead">BIM-Anwendungsfälle für Planung, Koordination, Kostenmanagement und Betrieb.</p>
                    </div>
                    <div class="gallery-filter-container">
                        <div class="gallery-filter-left">
                            <div class="gallery-filter-wrapper">
                                <input type="text" id="usecasesSearchInput" class="gallery-filter-input" placeholder="Suche nach Anwendungsfällen...">
                                <button type="button" class="search-clear-btn" id="usecasesSearchClear" aria-label="Suche löschen"><i data-lucide="x" aria-hidden="true"></i></button>
                                <button class="gallery-filter-btn" aria-label="Suchen"><i data-lucide="search" aria-hidden="true"></i></button>
                            </div>
                            ${renderFilterButton('usecases', usecasesFilterVisible, activeFiltersCount)}
                        </div>
                        <div class="view-switcher toolbar-control">
                            <button class="view-btn ${listActive}" onclick="switchView('list')" aria-label="Listenansicht"><i data-lucide="list" aria-hidden="true"></i></button>
                            <button class="view-btn ${gridActive}" onclick="switchView('grid')" aria-label="Rasteransicht"><i data-lucide="layout-grid" aria-hidden="true"></i></button>
                        </div>
                    </div>

                    ${renderFilterBar({
                        data: globalUsecasesData,
                        activeTags: activeTags,
                        activeCategory: activeCategory,
                        activePhases: activePhases,
                        showPhases: true,
                        filterPanelClass: filterPanelClass
                    })}

                    <div id="usecasesContent" class="catalog-content">
                        ${currentView === 'grid'
                            ? `<div class="element-grid">${renderUsecasesGridItemsHTML(filteredData, activeTags, activeCategory)}</div>`
                            : renderUsecasesListItemsHTML(filteredData, activeTags, activeCategory)
                        }
                    </div>
                </div>`;

            const searchInput = document.getElementById('usecasesSearchInput');
            if(searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    let searchFilteredData = filterDataByCategory(globalUsecasesData, activeCategory);
                    searchFilteredData = filterDataByTags(searchFilteredData, activeTags);
                    searchFilteredData = filterDataByPhases(searchFilteredData, activePhases);
                    searchFilteredData = searchFilteredData.filter(item =>
                        item.title.toLowerCase().includes(searchTerm) ||
                        item.category.toLowerCase().includes(searchTerm) ||
                        item.description.toLowerCase().includes(searchTerm)
                    );
                    const container = document.getElementById('usecasesContent');
                    container.innerHTML = (getActiveViewFromURL() === 'grid')
                        ? `<div class="element-grid">${renderUsecasesGridItemsHTML(searchFilteredData, activeTags, activeCategory)}</div>`
                        : renderUsecasesListItemsHTML(searchFilteredData, activeTags, activeCategory);
                });
            }

            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Setup clear button
            setupSearchClearButton('usecasesSearchInput', 'usecasesSearchClear');
        }

        function renderUsecaseDetailPage(id, activeTags = [], activeCategory = '') {
            const data = globalUsecasesData.find(item => item.id === id);
            if(!data) {
                contentArea.innerHTML = '<div class="container error-state">Anwendungsfall nicht gefunden.</div>';
                return;
            }

            const backLink = buildHashWithTags('usecases', activeTags, activeCategory, [], getActiveViewFromURL());

            // Sidebar navigation links
            const sidebarLinksData = [
                { id: 'phasen', text: 'Phasen' },
                { id: 'ziele', text: 'Ziele' },
                { id: 'rollen', text: 'Rollen' },
                { id: 'eingaben', text: 'Eingaben' },
                { id: 'ausgaben', text: 'Ausgaben' },
                ...(data.process_url ? [{ id: 'prozess', text: 'Prozess' }] : []),
                { id: 'verknuepfungen', text: 'Verknüpfungen' }
            ];
            const sidebarLinks = sidebarLinksData.map(link => `<a href="#${link.id}" class="sidebar-link" data-target="${link.id}">${link.text}</a>`).join('');

            // Render all 5 phases (1-5), highlight active ones
            const allPhases = [1, 2, 3, 4, 5];
            const phasesHtml = allPhases.map(p => {
                const isActive = data.phases && data.phases.includes(p);
                return `<span class="phase-badge ${isActive ? 'active' : 'inactive'}" title="Phase ${p}">${p}</span>`;
            }).join('');

            // Render goals as table
            const goalsRowsHtml = data.goals && data.goals.length > 0
                ? data.goals.map(goal => `<tr><td class="col-val">${goal}</td></tr>`).join('')
                : '<tr><td class="col-center empty-text">Keine Ziele definiert.</td></tr>';

            // Render inputs table
            const inputsRowsHtml = data.inputs && data.inputs.length > 0
                ? data.inputs.map(input => `<tr><td class="col-val">${input}</td></tr>`).join('')
                : '<tr><td class="col-center empty-text">Keine Eingaben definiert.</td></tr>';

            // Render outputs table
            const outputsRowsHtml = data.outputs && data.outputs.length > 0
                ? data.outputs.map(output => `<tr><td class="col-val">${output}</td></tr>`).join('')
                : '<tr><td class="col-center empty-text">Keine Ausgaben definiert.</td></tr>';

            // Render roles RACI table (without bullet points)
            const rolesRowsHtml = data.roles && data.roles.length > 0
                ? data.roles.map(role => `
                    <tr>
                        <td class="col-val col-actor">${role.actor}</td>
                        <td class="col-val">${role.responsible && role.responsible.length > 0 ? role.responsible.join(', ') : '-'}</td>
                        <td class="col-val">${role.contributing && role.contributing.length > 0 ? role.contributing.join(', ') : '-'}</td>
                        <td class="col-val">${role.informed && role.informed.length > 0 ? role.informed.join(', ') : '-'}</td>
                    </tr>`).join('')
                : '<tr><td colspan="4" class="col-center empty-text">Keine Rollen definiert.</td></tr>';

            contentArea.innerHTML = `
                <section class="detail-hero">
                    <div class="container detail-hero__inner">
                        <div class="hero-content">
                            <div class="breadcrumb"><a href="#${backLink}"><i data-lucide="arrow-left" style="vertical-align: text-bottom; margin-right:5px; width: 1.1rem; height: 1.1rem;"></i> Zurück zur Liste</a></div>
                            <h1 class="hero-title">${data.title}</h1>
                            <p class="hero-subtitle">${data.description || 'Ein Anwendungsfall des KBOB Datenkatalogs.'}</p>
                            <div class="hero-tags">${renderTagsHtml(data.tags, activeTags)}</div>
                        </div>
                        <div class="hero-image-container">
                            ${data.image ? `<img src="${data.image}" alt="${data.title}">` : '<i data-lucide="workflow" class="hero-image-placeholder icon--4xl"></i>'}
                        </div>
                    </div>
                </section>

                <div class="container">
                    <div class="detail-layout">
                        <aside class="detail-sidebar"><nav class="sticky-nav">${sidebarLinks}</nav></aside>
                        <div class="detail-content-area">
                            <div class="detail-section" id="phasen">
                                <h2>Projektphasen</h2>
                                <p>Relevante Projektphasen für diesen Anwendungsfall.</p>
                                <div class="phases-container phases-container--large">${phasesHtml}</div>
                            </div>

                            <div class="detail-section" id="ziele">
                                <h2>Ziele</h2>
                                <table class="data-table">
                                    <thead><tr><th>Beschreibung</th></tr></thead>
                                    <tbody>${goalsRowsHtml}</tbody>
                                </table>
                            </div>

                            <div class="detail-section" id="rollen">
                                <h2>Rollen & Verantwortlichkeiten</h2>
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th class="th-w-20">Akteur</th>
                                            <th>Verantwortlich (R)</th>
                                            <th>Mitwirkend (C)</th>
                                            <th>Informiert (I)</th>
                                        </tr>
                                    </thead>
                                    <tbody>${rolesRowsHtml}</tbody>
                                </table>
                            </div>

                            <div class="detail-section" id="eingaben">
                                <h2>Eingaben</h2>
                                <p>Erforderliche Informationen und Dokumente für diesen Anwendungsfall.</p>
                                <table class="data-table">
                                    <thead><tr><th>Bezeichnung</th></tr></thead>
                                    <tbody>${inputsRowsHtml}</tbody>
                                </table>
                            </div>

                            <div class="detail-section" id="ausgaben">
                                <h2>Ausgaben</h2>
                                <p>Ergebnisse und Lieferobjekte dieses Anwendungsfalls.</p>
                                <table class="data-table">
                                    <thead><tr><th>Bezeichnung</th></tr></thead>
                                    <tbody>${outputsRowsHtml}</tbody>
                                </table>
                            </div>

                            ${data.process_url ? `
                            <div class="detail-section" id="prozess">
                                <h2>Prozess</h2>
                                <p>BPMN-Prozessdiagramm für diesen Anwendungsfall.</p>
                                <div class="bpmn-viewer-container">
                                    <iframe
                                        src="${data.process_url}"
                                        title="BPMN Prozessdiagramm"
                                        allowfullscreen>
                                    </iframe>
                                </div>
                            </div>` : ''}

                            <div class="detail-section" id="verknuepfungen">
                                <h2>Verknüpfungen</h2>
                                <p>Verknüpfte Dokumente und Elemente für diesen Anwendungsfall.</p>
                                <div class="info-box info-box--inline">
                                    <i data-lucide="construction" class="info-box__icon"></i>
                                    <div>
                                        <p class="info-box__text">Diese Funktion wird derzeit entwickelt. Hier werden zukünftig verknüpfte Dokumente und Elemente angezeigt.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;

            setupDetailInteractions();
        }

        // ============================================
        // MODELS CATALOG AND DETAIL PAGES
        // ============================================

        function renderModelsCatalogPage(activeTags = [], activeCategory = '') {
            // Apply both category and tag filtering
            let filteredData = filterDataByCategory(globalModelsData, activeCategory);
            filteredData = filterDataByTags(filteredData, activeTags);

            const filterPanelClass = modelsFilterVisible ? '' : 'closed';
            const currentView = getActiveViewFromURL();
            const gridActive = currentView === 'grid' ? 'active' : '';
            const listActive = currentView === 'list' ? 'active' : '';
            const activeFiltersCount = activeTags.length + (activeCategory ? 1 : 0);

            contentArea.innerHTML = `
                <div class="container">
                    <div class="page-header">
                        <h1 class="page-title">Fachmodelle</h1>
                        <p class="page-lead">Domänenspezifische BIM-Modelle für Architektur, Tragwerk, Haustechnik und weitere Fachbereiche.</p>
                    </div>
                    <div class="gallery-filter-container">
                        <div class="gallery-filter-left">
                            <div class="gallery-filter-wrapper">
                                <input type="text" id="modelsSearchInput" class="gallery-filter-input" placeholder="Suche nach Fachmodellen...">
                                <button type="button" class="search-clear-btn" id="modelsSearchClear" aria-label="Suche löschen"><i data-lucide="x" aria-hidden="true"></i></button>
                                <button class="gallery-filter-btn" aria-label="Suchen"><i data-lucide="search" aria-hidden="true"></i></button>
                            </div>
                            ${renderFilterButton('models', modelsFilterVisible, activeFiltersCount)}
                        </div>
                        <div class="view-switcher toolbar-control">
                            <button class="view-btn ${listActive}" onclick="switchView('list')" aria-label="Listenansicht"><i data-lucide="list" aria-hidden="true"></i></button>
                            <button class="view-btn ${gridActive}" onclick="switchView('grid')" aria-label="Rasteransicht"><i data-lucide="layout-grid" aria-hidden="true"></i></button>
                        </div>
                    </div>

                    ${renderFilterBar({
                        data: globalModelsData,
                        activeTags: activeTags,
                        activeCategory: activeCategory,
                        filterPanelClass: filterPanelClass
                    })}

                    <div id="modelsContent" class="catalog-content">
                        ${currentView === 'grid'
                            ? `<div class="element-grid">${renderModelsGridItemsHTML(filteredData, activeTags, activeCategory)}</div>`
                            : renderModelsListItemsHTML(filteredData, activeTags, activeCategory)
                        }
                    </div>
                </div>`;

            const searchInput = document.getElementById('modelsSearchInput');
            if(searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    let searchFilteredData = filterDataByCategory(globalModelsData, activeCategory);
                    searchFilteredData = filterDataByTags(searchFilteredData, activeTags);
                    searchFilteredData = searchFilteredData.filter(item =>
                        item.title.toLowerCase().includes(searchTerm) ||
                        item.category.toLowerCase().includes(searchTerm) ||
                        item.description.toLowerCase().includes(searchTerm)
                    );
                    const container = document.getElementById('modelsContent');
                    container.innerHTML = (getActiveViewFromURL() === 'grid')
                        ? `<div class="element-grid">${renderModelsGridItemsHTML(searchFilteredData, activeTags, activeCategory)}</div>`
                        : renderModelsListItemsHTML(searchFilteredData, activeTags, activeCategory);
                });
            }

            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Setup clear button
            setupSearchClearButton('modelsSearchInput', 'modelsSearchClear');
        }

        function renderModelDetailPage(id, activeTags = [], activeCategory = '') {
            const data = globalModelsData.find(item => item.id === id);
            if(!data) {
                contentArea.innerHTML = '<div class="container error-state">Fachmodell nicht gefunden.</div>';
                return;
            }

            const backLink = buildHashWithTags('models', activeTags, activeCategory, [], getActiveViewFromURL());

            contentArea.innerHTML = `
                <section class="detail-hero">
                    <div class="container detail-hero__inner">
                        <div class="hero-content">
                            <div class="breadcrumb"><a href="#${backLink}"><i data-lucide="arrow-left" style="vertical-align: text-bottom; margin-right:5px; width: 1.1rem; height: 1.1rem;"></i> Zurück zur Liste</a></div>
                            <h1 class="hero-title">${data.title}</h1>
                            <p class="hero-subtitle">${data.description || 'Ein Fachmodell des KBOB Datenkatalogs.'}</p>
                            <div class="hero-tags">${renderTagsHtml(data.tags, activeTags)}</div>
                        </div>
                        <div class="hero-image-container">
                            ${data.image ? `<img src="${data.image}" alt="${data.title}">` : '<i data-lucide="boxes" class="hero-image-placeholder icon--4xl"></i>'}
                        </div>
                    </div>
                </section>
                <div class="container">
                    <div class="info-box info-box--centered">
                        <i data-lucide="hard-hat" class="info-box__icon icon--4xl"></i>
                        <h2 class="info-box__title">In Entwicklung</h2>
                        <p class="info-box__text">Die Detail-Ansicht für Fachmodelle wird derzeit entwickelt.</p>
                    </div>
                </div>`;
        }

        // ============================================
        // EPDS CATALOG AND DETAIL PAGES
        // ============================================

        function renderEpdsCatalogPage(activeTags = [], activeCategory = '') {
            // Apply both category and tag filtering
            let filteredData = filterDataByCategory(globalEpdsData, activeCategory);
            filteredData = filterDataByTags(filteredData, activeTags);

            const filterPanelClass = epdsFilterVisible ? '' : 'closed';
            const currentView = getActiveViewFromURL();
            const gridActive = currentView === 'grid' ? 'active' : '';
            const listActive = currentView === 'list' ? 'active' : '';
            const activeFiltersCount = activeTags.length + (activeCategory ? 1 : 0);

            contentArea.innerHTML = `
                <div class="container">
                    <div class="page-header">
                        <h1 class="page-title">Ökobilanzdaten</h1>
                        <p class="page-lead">Umweltproduktdeklarationen (EPD) und Ökobilanzkennwerte für Baumaterialien und Gebäudetechnik.</p>
                    </div>
                    <div class="gallery-filter-container">
                        <div class="gallery-filter-left">
                            <div class="gallery-filter-wrapper">
                                <input type="text" id="epdsSearchInput" class="gallery-filter-input" placeholder="Suche nach Ökobilanzdaten...">
                                <button type="button" class="search-clear-btn" id="epdsSearchClear" aria-label="Suche löschen"><i data-lucide="x" aria-hidden="true"></i></button>
                                <button class="gallery-filter-btn" aria-label="Suchen"><i data-lucide="search" aria-hidden="true"></i></button>
                            </div>
                            ${renderFilterButton('epds', epdsFilterVisible, activeFiltersCount)}
                        </div>
                        <div class="view-switcher toolbar-control">
                            <button class="view-btn ${listActive}" onclick="switchView('list')" aria-label="Listenansicht"><i data-lucide="list" aria-hidden="true"></i></button>
                            <button class="view-btn ${gridActive}" onclick="switchView('grid')" aria-label="Rasteransicht"><i data-lucide="layout-grid" aria-hidden="true"></i></button>
                        </div>
                    </div>

                    ${renderFilterBar({
                        data: globalEpdsData,
                        activeTags: activeTags,
                        activeCategory: activeCategory,
                        filterPanelClass: filterPanelClass
                    })}

                    <div id="epdsContent" class="catalog-content">
                        ${currentView === 'grid'
                            ? `<div class="element-grid">${renderEpdsGridItemsHTML(filteredData, activeTags, activeCategory)}</div>`
                            : renderEpdsListItemsHTML(filteredData, activeTags, activeCategory)
                        }
                    </div>
                </div>`;

            const searchInput = document.getElementById('epdsSearchInput');
            if(searchInput) {
                searchInput.addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    let searchFilteredData = filterDataByCategory(globalEpdsData, activeCategory);
                    searchFilteredData = filterDataByTags(searchFilteredData, activeTags);
                    searchFilteredData = searchFilteredData.filter(item =>
                        item.title.toLowerCase().includes(searchTerm) ||
                        item.category.toLowerCase().includes(searchTerm) ||
                        item.description.toLowerCase().includes(searchTerm)
                    );
                    const container = document.getElementById('epdsContent');
                    container.innerHTML = (getActiveViewFromURL() === 'grid')
                        ? `<div class="element-grid">${renderEpdsGridItemsHTML(searchFilteredData, activeTags, activeCategory)}</div>`
                        : renderEpdsListItemsHTML(searchFilteredData, activeTags, activeCategory);
                });
            }

            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Setup clear button
            setupSearchClearButton('epdsSearchInput', 'epdsSearchClear');
        }

        function renderEpdDetailPage(id, activeTags = [], activeCategory = '') {
            const data = globalEpdsData.find(item => item.id === id);
            if(!data) {
                contentArea.innerHTML = '<div class="container error-state">Ökobilanzdaten nicht gefunden.</div>';
                return;
            }

            const backLink = buildHashWithTags('epds', activeTags, activeCategory, [], getActiveViewFromURL());

            contentArea.innerHTML = `
                <section class="detail-hero">
                    <div class="container detail-hero__inner">
                        <div class="hero-content">
                            <div class="breadcrumb"><a href="#${backLink}"><i data-lucide="arrow-left" style="vertical-align: text-bottom; margin-right:5px; width: 1.1rem; height: 1.1rem;"></i> Zurück zur Liste</a></div>
                            <h1 class="hero-title">${data.title}</h1>
                            <p class="hero-subtitle">${data.description || 'Ein Ökobilanzdatensatz des KBOB Datenkatalogs.'}</p>
                            <div class="hero-tags">${renderTagsHtml(data.tags, activeTags)}</div>
                        </div>
                        <div class="hero-image-container">
                            ${data.image ? `<img src="${data.image}" alt="${data.title}">` : '<i data-lucide="leaf" class="hero-image-placeholder icon--4xl"></i>'}
                        </div>
                    </div>
                </section>
                <div class="container">
                    <div class="info-box info-box--centered">
                        <i data-lucide="hard-hat" class="info-box__icon icon--4xl"></i>
                        <h2 class="info-box__title">In Entwicklung</h2>
                        <p class="info-box__text">Die Detail-Ansicht für Ökobilanzdaten wird derzeit entwickelt.</p>
                    </div>
                </div>`;
        }

        function setupDetailInteractions() {
             document.querySelectorAll('.sidebar-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('data-target');
                    const element = document.getElementById(targetId);
                    if(element) element.scrollIntoView({behavior: 'smooth', block: 'start'});
                });
             });
             
             setTimeout(() => {
                 const sectionHash = window.location.hash.split('#')[2];
                 if(sectionHash) document.getElementById(sectionHash)?.scrollIntoView({behavior: 'smooth', block: 'start'});
                 
                 const sections = document.querySelectorAll('.detail-section');
                 const navLinks = document.querySelectorAll('.sticky-nav a');
                 
                 const observer = new IntersectionObserver((entries) => {
                     entries.forEach(entry => {
                         if (entry.isIntersecting) {
                             navLinks.forEach(link => {
                                 const target = link.getAttribute('data-target');
                                 link.classList.toggle('active', target === entry.target.id);
                             });
                         }
                     });
                 }, { threshold: 0.2, rootMargin: "-10% 0px -70% 0px" });
                 
                 sections.forEach(section => observer.observe(section));
             }, 100);
        }

        // Language Dropdown
        function initLanguageDropdown() {
            const dropdown = document.getElementById('langDropdown');
            if (!dropdown) return;

            const toggle = dropdown.querySelector('.lang-dropdown__toggle');
            const menu = dropdown.querySelector('.lang-dropdown__menu');
            const items = dropdown.querySelectorAll('.lang-dropdown__item');
            const currentLang = document.getElementById('currentLang');

            // Toggle dropdown
            toggle.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = dropdown.classList.toggle('open');
                toggle.setAttribute('aria-expanded', isOpen);
            });

            // Select language
            items.forEach(item => {
                item.addEventListener('click', () => {
                    const lang = item.dataset.lang;

                    // Update active state
                    items.forEach(i => i.classList.remove('active'));
                    item.classList.add('active');

                    // Update button text
                    currentLang.textContent = lang.toUpperCase();

                    // Close dropdown
                    dropdown.classList.remove('open');
                    toggle.setAttribute('aria-expanded', 'false');

                    console.log('Language selected:', lang);
                });
            });

            // Close on outside click
            document.addEventListener('click', (e) => {
                if (!dropdown.contains(e.target)) {
                    dropdown.classList.remove('open');
                    toggle.setAttribute('aria-expanded', 'false');
                }
            });

            // Keyboard support
            toggle.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    dropdown.classList.remove('open');
                    toggle.setAttribute('aria-expanded', 'false');
                }
            });
        }

        window.addEventListener('DOMContentLoaded', () => {
            // Initialize Lucide icons for loading state
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            initLanguageDropdown();
            initApp();
        });
    </script>
</body>
</html>
